  "version": "THYREN_FLOW_QUIZ_2.0_DOCTEUR",
  "description": "Quiz simplifié - THYREN utilise son raisonnement clinique Docteur 2.0 pour poser les bonnes questions après les infos de base",
  "flow_order": ["Q1","Q2","Q2_plus","Q3","Q4","Q4b","Q5","CLINICAL_QUESTIONS","Q_EMAIL","RESULT"],
  "nodes": {
    "Q1": {
      "id": "Q1",
      "type": "open",
      "text": "C'est parti !\nJe vais te poser quelques questions pour comprendre tes symptomes et te proposer la cure la plus adaptée à tes besoins.\nPour commencer, quel est ton prénom ?",
      "next": "Q2",
      "meta": { "capture": "first_name" }
    },
    "Q2": {
      "id": "Q2",
      "type": "choices",
      "text": "Enchanté {{first_name}}. Quel est ton sexe biologique ?",
      "choices": ["Femme","Homme"],
      "next_map": { "Femme": "Q2_plus", "Homme": "Q3" },
      "meta": { "capture": "sex" }
    },
    "Q2_plus": {
      "id": "Q2_plus",
      "type": "choices",
      "text": "Es-tu enceinte ou allaitante ?",
      "choices": ["Oui","Non"],
      "next": "Q3",
      "meta": { "capture": "enceinte" }
    },
    "Q3": {
      "id": "Q3",
      "type": "choices",
      "text": "Quel est ton âge ?",
      "choices": ["Moins de 30 ans","30-45 ans","45-60 ans","Plus de 60 ans"],
      "next": "Q4",
      "meta": { "capture": "age_band" }
    },
    "Q4": {
      "id": "Q4",
      "type": "choices",
      "text": "As-tu une condition médicale ou une allergie à signaler ?",
      "choices": ["Tout va bien","J'ai des allergies ou une condition médicale à signaler"],
      "next_map": { "Tout va bien": "Q5", "J'ai des allergies ou une condition médicale à signaler": "Q4b" },
      "meta": { "capture": "safety_flag" }
    },
    "Q4b": {
      "id": "Q4b",
      "type": "open",
      "text": "Merci de préciser tes allergies ou ta condition médicale.",
      "next": "Q5",
      "meta": { "capture": "safety_details" }
    },
    "Q5": {
      "id": "Q5",
      "type": "open",
      "text": "Maintenant, raconte-moi ce qui te gêne en ce moment, ce que tu ressens et ce que tu aimerais améliorer. Prends ton temps, sois précis : tout peut m'aider à te proposer la cure la plus adaptée.",
      "next": "CLINICAL_QUESTIONS",
      "meta": { "capture": "plainte_client" }
    },
    "CLINICAL_QUESTIONS": {
      "id": "CLINICAL_QUESTIONS",
      "type": "ai_driven",
      "description": "THYREN utilise son raisonnement clinique Docteur 2.0 pour poser 2 à 4 questions ciblées basées sur la plainte_client. Chaque question a un OBJECTIF DIAGNOSTIQUE clair pour identifier l'axe fonctionnel prioritaire.",
      "rules": [
        "THYREN analyse la plainte_client et identifie les axes fonctionnels potentiellement impliqués",
        "THYREN pose 2 à 4 questions maximum (pas plus) avec des choices pertinents",
        "Chaque question doit aider à discriminer entre les axes (thyroïdien, énergétique, surrénalien, digestif, etc.)",
        "THYREN utilise son écoute active et son empathie à chaque question",
        "Quand THYREN a assez d'informations pour recommander UNE cure avec confiance, il passe à Q_EMAIL",
        "Si après 4 questions max THYREN n'est pas sûr, il recommande quand même la cure la plus probable"
      ],
      "next": "Q_EMAIL",
      "meta": { "mode": "clinical_reasoning" }
    },
    "Q_EMAIL": {
      "id": "Q_EMAIL",
      "type": "open",
      "text": "Merci pour toutes ces informations. Avant de te donner mes recommandations, peux-tu me partager ton adresse e-mail pour recevoir le récapitulatif de ton analyse et de la cure recommandée ?",
      "next_on_valid": "RESULT",
      "next_on_skip": "RESULT",
      "validation": { "type": "email_regex", "pattern": "^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Za-z]{2,}$" },
      "meta": { "capture": "email" }
    },
    "RESULT": { 
      "id": "RESULT", 
      "type": "terminal", 
      "action": "generate_report",
      "description": "THYREN génère les résultats avec l'approche Docteur 2.0"
    }
  },
  "engine_hints": {
    "state_model": { "current_id": "string", "answers": "map", "history": "array" },
    "clinical_mode": "THYREN doit utiliser son raisonnement clinique (section 3 du prompt) pour poser des questions intelligentes",
    "max_clinical_questions": 4
  }

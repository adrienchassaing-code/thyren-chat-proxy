const DATA_COMPOSITIONS = `
COMPOSITIONS SUPLEMINT
Version 0.9.0

Ce document contient la liste compl√®te des g√©lules/capsules SUPLEMINT
avec leurs ingr√©dients et dosages exacts.

LISTE DES CAPSULES

G√âLULE YAM¬Æ
Forme : g√©lule
Enveloppe : pullulane
Allerg√®nes : yam

Ingr√©dients :
  ‚Ä¢ Extrait de Yam (Dioscorea opposita) : 500 mg
  ‚Ä¢ Pullulane : non sp√©cifi√©

All√©gations :
  ‚Ä¢ L'Igname sauvage contribue au confort lors de la m√©nopause.

Alias : YAM, G√©lule YAM, YAM¬Æ

G√âLULE ADRENO+¬Æ
Forme : g√©lule
Enveloppe : pullulane
Allerg√®nes : aucun

Ingr√©dients :
  ‚Ä¢ Poudre d'algue Klamath (Aphanizomenon flos-aquae) : 200 mg (dont phycocyanine 11,3% = 22,6 mg)
  ‚Ä¢ Extrait de Bacopa monnieri : 150 mg (dont bacosides 50% = 75 mg)
  ‚Ä¢ Poudre de ginseng HRG80‚Ñ¢ : 50 mg
  ‚Ä¢ Extrait de Panax ginseng CA Meyer : 50 mg (dont gins√©no√Ødes totaux 11,45 mg / dont ginseng rares 5 mg)
  ‚Ä¢ Extrait de Ginkgo biloba : 60 mg (dont glycosides de flavonol 24% = 14,4 mg / dont terp√©no-lactones 6% = 3,6 mg)
  ‚Ä¢ L-Tyrosine : 37,5 mg
  ‚Ä¢ Oryza sativa L. : non sp√©cifi√©

Alias : ADRENO+, ADRENO_PLUS, ADRENO+¬Æ

G√âLULE OESTROBOOST¬Æ
Forme : g√©lule
Enveloppe : pullulane
Allerg√®nes : aucun

Ingr√©dients :
  ‚Ä¢ Extrait de houblon (Humulus lupulus) : 262,5 mg
  ‚Ä¢ Extrait de houblon (Lifenol¬Æ) : 62,5 mg
  ‚Ä¢ Extrait de sauge sclar√©e (Salvia sclarea) : 25 mg
  ‚Ä¢ Extrait de sauge officinale (Salvia officinalis) : 25 mg

All√©gations :
  ‚Ä¢ L'houblon contribue au bon sommeil, √† la relaxation, √† la sant√© digestive et au confort lors de la m√©nopause.
  ‚Ä¢ La sauge sclar√©e contribue aux d√©fenses naturelles de l'organisme.
  ‚Ä¢ La sauge officinale contribue √† la r√©gulation de la transpiration.

Alias : OESTROBOOST, OESTROBOOST¬Æ

G√âLULE BOURRACHE + ONAGRE¬Æ
Forme : g√©lule
Enveloppe : g√©latine
Allerg√®nes : aucun

Ingr√©dients :
  ‚Ä¢ Huile de bourrache (Borago officinalis L.) : 750 mg
  ‚Ä¢ Huile d'onagre (Oenothera biennis L.) : 750 mg
  ‚Ä¢ d-Œ± tocoph√©rol (vitamine E) : 22,5 mg

All√©gations :
  ‚Ä¢ La bourrache contribue au bon fonctionnement des voies respiratoires et favorise le confort articulaire.
  ‚Ä¢ La vitamine E contribue √† prot√©ger les cellules contre le stress oxydatif.

Alias : BOURRACHE + ONAGRE, BOURRACHE_ONAGRE, BOURRACHE + ONAGRE¬Æ

G√âLULE MULTI VIT¬Æ
Forme : g√©lule
Enveloppe : pullulane
Allerg√®nes : aucun
Contient de l'iode : OUI

Ingr√©dients :
  ‚Ä¢ Bisglycinate de zinc : 60 mg (dont zinc √©l√©ment 15 mg = 150% VNR)
  ‚Ä¢ Vitamine B3 (nicotinamide) : 54 mg (338% VNR)
  ‚Ä¢ Co-enzyme Q10 (ubiquinone) : 50 mg
  ‚Ä¢ Bio-flavono√Ødes d'agrumes (Citrus sinensis) : 33,33 mg
  ‚Ä¢ N-Ac√©tylCyst√©ine : 33,33 mg
  ‚Ä¢ Querc√©tine : 33,33 mg
  ‚Ä¢ Acide alpha-lipo√Øque : 33,33 mg
  ‚Ä¢ Myrtille (Vaccinium myrtillus L.) : 33,33 mg
  ‚Ä¢ Vitamine C (acide L-ascorbique) : 26,67 mg (33% VNR)
  ‚Ä¢ Levure de s√©l√©nium : 25 mg (dont s√©l√©nium √©l√©ment 50 ¬µg = 91% VNR)
  ‚Ä¢ Vitamine B5 (D-Pantoth√©nate de calcium) : 18 mg (300% VNR)
  ‚Ä¢ Vitamine E naturelle (Vitaph√©role¬Æ) : 12 mg (100% VNR)
  ‚Ä¢ Rutine : 6,67 mg
  ‚Ä¢ Vitamine B1 (chlorhydrate de thiamine) : 3,6 mg (327% VNR)
  ‚Ä¢ Lycop√®ne : 2,5 mg
  ‚Ä¢ Vitamine B2 (riboflavine) : 2,4 mg (171% VNR)
  ‚Ä¢ Ol√©or√©sine astaxanthine (Haematococcus pluvialis) : 2 mg
  ‚Ä¢ Lut√©ine : 2 mg
  ‚Ä¢ Vitamine B6 (pyridoxal phosphate) : 1,94 mg (139% VNR)
  ‚Ä¢ B√™ta-carot√®ne : 1,6 mg
  ‚Ä¢ Vitamine B8 (D-biotine) : 450 ¬µg (900% VNR)
  ‚Ä¢ Z√©axanthine : 400 ¬µg
  ‚Ä¢ Vitamine B9 (Quatrefolic¬Æ) : 200 ¬µg (100% VNR)
  ‚Ä¢ Iodure de potassium : 150 ¬µg (dont iode √©l√©ment 114,6 ¬µg = 76% VNR)
  ‚Ä¢ Vitamine K2 (m√©naquinone) : 75 ¬µg (100% VNR)
  ‚Ä¢ Vitamine D3 (chol√©calcif√©rol) : 25 ¬µg = 1000 UI (500% VNR)
  ‚Ä¢ Vitamine B12 (m√©thylcobalamine) : 1,6 ¬µg (64% VNR)
  ‚Ä¢ Vitamine B12 (hydroxycobalamine) : 1,6 ¬µg (64% VNR)

All√©gations :
  ‚Ä¢ Le zinc contribue au fonctionnement normal du syst√®me immunitaire.
  ‚Ä¢ Les vitamines B contribuent √† un m√©tabolisme √©nerg√©tique normal.

Alias : MULTI VIT, MULTI_VIT, MULTI VIT¬Æ

G√âLULE ENZYM+¬Æ
Forme : g√©lule
Enveloppe : DRcaps‚Ñ¢ (HPMC) gastror√©sistante
Allerg√®nes : aucun

Ingr√©dients :
  ‚Ä¢ Brom√©la√Øne : 100 mg
  ‚Ä¢ Papa√Øne : 75 mg
  ‚Ä¢ Gingembre (Zingiber officinale) : 50 mg
  ‚Ä¢ Amylase : 25 mg
  ‚Ä¢ Lipase : 25 mg
  ‚Ä¢ Prot√©ase (Ficus carica) : 25 mg
  ‚Ä¢ Trypsine : 25 mg

All√©gations :
  ‚Ä¢ Le gingembre contribue au bon fonctionnement du syst√®me digestif.

Alias : ENZYM+, ENZYM_PLUS, ENZYM+¬Æ

G√âLULE THYRO√èDE+¬Æ
Forme : g√©lule
Enveloppe : pullulane
Allerg√®nes : aucun
Contient de l'iode : OUI

Ingr√©dients :
  ‚Ä¢ Guggul (Commiphora mukul) : 266 mg (dont 26,6 mg de guggulst√©rones)
  ‚Ä¢ Ashwagandha (KSM-66¬Æ) (Withania somnifera) : 200 mg (dont 10 mg de withanolides)
  ‚Ä¢ L-tyrosine : 166,6 mg
  ‚Ä¢ Fucus v√©siculeux (Fucus vesiculosus) : 160 mg (dont 100 ¬µg d'iode = 66,6% VNR)
  ‚Ä¢ Bisglycinate de zinc : 33,33 mg (dont 10 mg de zinc = 100% VNR)
  ‚Ä¢ Levure de s√©l√©nium : 18,3 mg (dont 36,6 ¬µg de s√©l√©nium = 66,6% VNR)
  ‚Ä¢ Gluconate de mangan√®se : 5,4 mg (dont 0,66 mg de mangan√®se = 33,3% VNR)
  ‚Ä¢ M√©thylcobalamine (Vitamine B12) : 8,3 ¬µg (333,3% VNR)

All√©gations :
  ‚Ä¢ L'iode contribue √† la production normale d'hormones thyro√Ødiennes.
  ‚Ä¢ Le s√©l√©nium contribue √† une fonction thyro√Ødienne normale.
  ‚Ä¢ Le zinc contribue √† prot√©ger les cellules contre le stress oxydatif.

Alias : THYRO√èDE+, THYROIDE_PLUS, THYROIDE+¬Æ

G√âLULE L-TYRO TOP¬Æ
Forme : g√©lule
Enveloppe : pullulane
Allerg√®nes : aucun

Ingr√©dients :
  ‚Ä¢ L-Tyrosine : 125 mg
  ‚Ä¢ Acide ascorbique (Vitamine C) : 30 mg (37,5% VNR)
  ‚Ä¢ Nicotinamide (Vitamine B3) : 6 mg (37,5% VNR)
  ‚Ä¢ Riboflavine (Vitamine B2) : 525 ¬µg (37,5% VNR)
  ‚Ä¢ Chlorhydrate de pyridoxine (Vitamine B6) : 525 ¬µg (37,5% VNR)
  ‚Ä¢ Quatrefolic¬Æ (Vitamine B9) : 75 ¬µg (37,5% VNR)
  ‚Ä¢ M√©thylcobalamine (Vitamine B12) : 0,94 ¬µg (37,5% VNR)

All√©gations :
  ‚Ä¢ La L-tyrosine contribue √† la synth√®se normale des cat√©cholamines.

Alias : L-TYRO TOP, L_TYRO_TOP, L-TYRO TOP¬Æ

G√âLULE L-TYRO ACTIV¬Æ
Forme : g√©lule
Enveloppe : pullulane
Allerg√®nes : aucun

Ingr√©dients :
  ‚Ä¢ L-Tyrosine : 500 mg

All√©gations :
  ‚Ä¢ La L-tyrosine contribue √† la synth√®se normale des cat√©cholamines.

Alias : L-TYRO ACTIV, L_TYRO_ACTIV, L-TYRO ACTIV¬Æ

CAPSULE MAG TOP¬Æ
Forme : capsule
Enveloppe : HPMC
Allerg√®nes : aucun

Ingr√©dients :
  ‚Ä¢ Bisglycinate de magn√©sium : 700 mg (dont 70 mg de magn√©sium √©l√©ment)
  ‚Ä¢ Glyc√©rophosphate de magn√©sium : 700 mg (dont 81,9 mg de magn√©sium √©l√©ment)
  ‚Ä¢ Malate de magn√©sium : 250 mg (dont 37,5 mg de magn√©sium √©l√©ment)

All√©gations :
  ‚Ä¢ Le magn√©sium contribue au fonctionnement normal du syst√®me nerveux.
  ‚Ä¢ Le magn√©sium contribue √† r√©duire la fatigue.

Alias : MAG TOP, MAG_TOP, MAG TOP¬Æ

G√âLULE PHENOL+¬Æ
Forme : g√©lule
Enveloppe : pullulane
Allerg√®nes : aucun

Ingr√©dients :
  ‚Ä¢ Extrait de romarin (Rosmarinus officinalis) : 100 mg (dont 6% d'acide rosmarinique)
  ‚Ä¢ MitoActiv‚Ñ¢ (cassis + groseille) : non sp√©cifi√© (dont 10% de polyph√©nols)
  ‚Ä¢ Extrait de Sophora japonica : 50 mg (dont 98% de querc√©tine)
  ‚Ä¢ Extrait de p√©pin de raisin (Vitis vinifera) : 50 mg (dont 40% OPC et 30% monom√®res)
  ‚Ä¢ Extrait de cacao (Theobroma cacao) : 50 mg (dont 10% de polyph√©nols)
  ‚Ä¢ Extrait de grenade (Punica granatum) : 50 mg (dont 90% d'acide ellagique)
  ‚Ä¢ Extrait d'orange (Citrus sinensis) : 50 mg (dont 45% de polyph√©nols)
  ‚Ä¢ Extrait de feuille d'olivier (Olea europaea) : 50 mg (dont 20% d'hydroxytyrosol)
  ‚Ä¢ Extrait de myrtille (Vaccinium myrtillus) : 50 mg (dont 10% de polyph√©nols)
  ‚Ä¢ Extrait d'√©corce de pin sylvestre (Pinus sylvestris) : non sp√©cifi√©

All√©gations :
  ‚Ä¢ Le romarin est un antioxydant naturel.
  ‚Ä¢ Le romarin favorise le bon fonctionnement du syst√®me immunitaire.

Alias : PHENOL+, PHENOL_PLUS, PHENOL+¬Æ

G√âLULE ANTIOX¬Æ
Forme : g√©lule
Enveloppe : pullulane
Allerg√®nes : trace de caf√©ine

Ingr√©dients :
  ‚Ä¢ Ac√©rola (Malpighia glabra L.) : 160 mg (dont 25% de vitamine C)
  ‚Ä¢ Th√© vert (Camellia sinensis) : 125 mg (dont 56,25 mg EGCG, caf√©ine ‚â§ 10 mg)
  ‚Ä¢ Resv√©ratrol : 100 mg
  ‚Ä¢ Co-enzyme Q10 : 100 mg
  ‚Ä¢ Raisin (Vitis vinifera L.) : 52,64 mg (dont 50 mg OPC)

All√©gations :
  ‚Ä¢ La vitamine C contribue √† prot√©ger les cellules contre le stress oxydatif.

Alias : ANTIOX, ANTIOX¬Æ

CAPSULE KRILL¬Æ
Forme : capsule
Enveloppe : g√©latine de poisson
Allerg√®nes : crustac√©s, poisson

Ingr√©dients :
  ‚Ä¢ Extrait lipidique de krill (Euphausia superba) : 590 mg
    - phospholipides 330 mg
    - om√©ga-3 160 mg (EPA+DHA 125 mg)
    - choline 41,12 mg
    - astaxanthine 60 ¬µg

Alias : KRILL, KRILL¬Æ

CAPSULE KLAMATH¬Æ
Forme : capsule
Enveloppe : pullulane
Allerg√®nes : aucun

Ingr√©dients :
  ‚Ä¢ Poudre d'algue Klamath (Aphanizomenon flos-aquae) : 1000 mg
    - dont 56,5 mg phycocyanine
    - dont 5,5 mg ph√©nyl√©thylamine

Alias : KLAMATH, KLAMATH¬Æ

CAPSULE OMEGA 3¬Æ
Forme : capsule
Enveloppe : g√©latine de poisson
Allerg√®nes : poisson

Ingr√©dients :
  ‚Ä¢ Huile de poisson (qualit√© EPAX) : 1000 mg
    - om√©ga-3 EPA+DHA 700 mg (EPA min 400 mg / DHA min 300 mg)

All√©gations :
  ‚Ä¢ Le DHA contribue au fonctionnement normal du cerveau.
  ‚Ä¢ L'EPA et le DHA contribuent √† une fonction cardiaque normale.

Alias : OMEGA 3, OMEGA3, OMEGA-3, OMEGA 3¬Æ

G√âLULE BIO ACTIV¬Æ
Forme : g√©lule
Enveloppe : DRcaps‚Ñ¢ (HPMC) gastror√©sistante
Allerg√®nes : aucun

Ingr√©dients :
  ‚Ä¢ Fibre d'acacia bio : non sp√©cifi√©
  ‚Ä¢ Lactobacillus acidophilus : 3,32 milliards
  ‚Ä¢ Lactobacillus rhamnosus : 3,32 milliards
  ‚Ä¢ Bifidobacterium bifidum : 3,32 milliards
  ‚Ä¢ Bifidobacterium longum : 3,32 milliards
  ‚Ä¢ Bifidobacterium lactis : 3,32 milliards
  ‚Ä¢ Streptococcus thermophilus : 3,32 milliards

Alias : BIO ACTIV, BIO_ACTIV, BIO ACTIV¬Æ

G√âLULE B9 4FOLIC¬Æ
Forme : g√©lule
Enveloppe : pullulane
Allerg√®nes : aucun

Ingr√©dients :
  ‚Ä¢ Fibre d'acacia BIO : non sp√©cifi√©
  ‚Ä¢ Acide folique (Quatrefolic¬Æ) : 360 ¬µg (180% VNR)

All√©gations :
  ‚Ä¢ Les folates contribuent √† la croissance des tissus maternels durant la grossesse.

Alias : B94FOLIC, B9_4FOLIC, B9 4FOLIC¬Æ

G√âLULE MG MALATE¬Æ
Forme : g√©lule
Enveloppe : g√©latine bovine
Allerg√®nes : g√©latine bovine

Ingr√©dients :
  ‚Ä¢ Malate de magn√©sium : 1500 mg (dont 225 mg de magn√©sium √©l√©ment = 60% VNR)

All√©gations :
  ‚Ä¢ Le magn√©sium contribue √† r√©duire la fatigue.

Alias : MG MALATE, MG_MALATE, MG MALATE¬Æ

CAPSULE SVELT OMEGA 3¬Æ
Forme : capsule
Enveloppe : g√©latine de poisson
Allerg√®nes : poisson, crustac√©s

Ingr√©dients :
  ‚Ä¢ Huile de Calanus finmarchicus (crustac√©s) : 1000 mg

All√©gations :
  ‚Ä¢ L'EPA et le DHA contribuent √† une fonction cardiaque normale.

Alias : SVELT OMEGA 3, SVELT_OMEGA3, SVELT OMEGA3¬Æ

G√âLULE BERBERINE ACTIV¬Æ
Forme : g√©lule
Enveloppe : pullulane
Allerg√®nes : aucun

Ingr√©dients :
  ‚Ä¢ Berb√©rine HB¬Æ : 375 mg

Alias : BERBERINE ACTIV, BERBERINE_ACTIV, BERBERINE ACTIV¬Æ

CAPSULE COQ10¬Æ
Forme : capsule
Enveloppe : pullulane
Allerg√®nes : aucun

Ingr√©dients :
  ‚Ä¢ Co-enzyme Q10 LEO HB : non sp√©cifi√©
  ‚Ä¢ Fibre d'acacia : non sp√©cifi√©

Alias : COQ10, COQ10¬Æ

G√âLULE ACETYL CARN¬Æ
Forme : g√©lule
Enveloppe : pullulane
Allerg√®nes : aucun

Ingr√©dients :
  ‚Ä¢ Ac√©tyl-L-Carnitine : 1500 mg

Alias : ACETYL CARN, ACETYL_CARN, ACETYL CARN¬Æ

G√âLULE GASTRATOP¬Æ
Forme : g√©lule
Enveloppe : pullulane
Allerg√®nes : aucun
Contient de l'iode : OUI

Ingr√©dients :
  ‚Ä¢ Gamma-Oryzanol : 250 mg
  ‚Ä¢ Fucus v√©siculeux (Fucus vesiculosus) : 120 mg (dont 75 ¬µg d'iode = 50% VNR)
  ‚Ä¢ R√©glisse (Glycyrrhiza glabra) d√©glycyrrhizin√©e : 50 mg
  ‚Ä¢ Vitamine U (DL-Methionine Methylsulfonium Chloride) : 50 mg
  ‚Ä¢ L-Cyst√©ine : 2,5 mg
  ‚Ä¢ Vitamine B1 (thiamine mononitrate) : 0,62 mg (56,4% VNR)

Alias : GASTRATOP, GASTRATOP¬Æ

G√âLULE TRANSITEAM¬Æ
Forme : g√©lule
Enveloppe : pullulane
Allerg√®nes : aucun

Ingr√©dients :
  ‚Ä¢ Enveloppe de psyllium (Plantago ovata) : 1500 mg
  ‚Ä¢ Gomme d'acacia bio : non sp√©cifi√©
  ‚Ä¢ Lactobacillus acidophilus : 1250 millions
  ‚Ä¢ Lactobacillus rhamnosus : 1250 millions
  ‚Ä¢ Bifidobacterium bifidum : 1250 millions
  ‚Ä¢ Bifidobacterium longum : 1250 millions
  ‚Ä¢ Bifidobacterium lactis : 1250 millions
  ‚Ä¢ Streptococcus thermophilus : 1250 millions

Alias : TRANSITEAM, TRANSITEAM¬Æ

G√âLULE VITAMINE C¬Æ
Forme : g√©lule
Enveloppe : pullulane
Allerg√®nes : aucun

Ingr√©dients :
  ‚Ä¢ Vitamine C (acide L-ascorbique) : 650 mg (821% VNR)

All√©gations :
  ‚Ä¢ La vitamine C contribue √† r√©duire la fatigue.
  ‚Ä¢ La vitamine C contribue au fonctionnement normal du syst√®me immunitaire.

Alias : VITAMINE C, VITAMINE_C, VITAMINE C¬Æ

G√âLULE MAGNESIUM+¬Æ
Forme : g√©lule
Enveloppe : HPMC
Allerg√®nes : aucun

Ingr√©dients :
  ‚Ä¢ Glyc√©rophosphate de magn√©sium : 741,88 mg
  ‚Ä¢ Bisglycinate de magn√©sium : 300 mg (magn√©sium √©l√©ment total = 146,8 mg = 39% VNR)
  ‚Ä¢ Taurine : 200 mg
  ‚Ä¢ Nicotinamide (Vitamine B3) : 17 mg (106% VNR)
  ‚Ä¢ Acide pantoth√©nique (Vitamine B5) : 9 mg (150% VNR)
  ‚Ä¢ Pyridoxine (Vitamine B6) : 3,4 mg (243% VNR)
  ‚Ä¢ Thiamine (Vitamine B1) : 3,2 mg (290% VNR)
  ‚Ä¢ Riboflavine (Vitamine B2) : 2 mg (143% VNR)
  ‚Ä¢ D-biotine (Vitamine B8) : 150 ¬µg (300% VNR)
  ‚Ä¢ Acide folique (Vitamine B9) : 100 ¬µg (50% VNR)
  ‚Ä¢ Chol√©calcif√©rol (Vitamine D3) : 7,5 ¬µg (150% VNR)
  ‚Ä¢ M√©thylcobalamine (Vitamine B12) : 2 ¬µg (80% VNR)

All√©gations :
  ‚Ä¢ Le magn√©sium contribue au fonctionnement normal du syst√®me nerveux.
  ‚Ä¢ Le magn√©sium contribue √† r√©duire la fatigue.

Alias : MAGNESIUM+, MAGNESIUM_PLUS, MAGNESIUM+¬Æ

G√âLULE MELATOP¬Æ
Forme : g√©lule
Enveloppe : pullulane
Allerg√®nes : aucun

Ingr√©dients :
  ‚Ä¢ Val√©riane (Valeriana officinalis L.) : 250 mg
  ‚Ä¢ Lavande (Lavandula angustifolia Mill.) : 150 mg
  ‚Ä¢ Passiflore (Passiflora incarnata L.) : 150 mg (dont 6 mg de flavono√Ødes)
  ‚Ä¢ Eschscholzia de Californie (Eschscholzia californica) : 150 mg
  ‚Ä¢ GABA : 150 mg
  ‚Ä¢ Aub√©pine (Crataegus monogyna Jacq.) : 140 mg (dont 2,4 mg de vitexine)
  ‚Ä¢ Safran (Crocus sativus) : 45 mg
  ‚Ä¢ Arginine : 45 mg
  ‚Ä¢ Nicotinamide (Vitamine B3) : 37 mg (205% VNR)
  ‚Ä¢ M√©latonine : 0,299 mg

All√©gations :
  ‚Ä¢ La m√©latonine contribue √† r√©duire le temps d'endormissement.
  ‚Ä¢ La val√©riane contribue √† un sommeil de qualit√©.

Alias : MELATOP, MELATOP¬Æ

G√âLULE ASHWAGANDHA¬Æ
Forme : g√©lule
Enveloppe : pullulane
Allerg√®nes : aucun

Ingr√©dients :
  ‚Ä¢ Ashwagandha (KSM-66¬Æ) (Withania somnifera L.) : 600 mg (dont 30 mg de withanolides)

All√©gations :
  ‚Ä¢ L'ashwagandha contribue √† une bonne sant√© mentale et √† la relaxation.
  ‚Ä¢ L'ashwagandha poss√®de une action adaptog√®ne.

Alias : ASHWAGANDHA, ASHWAGANDHA¬Æ

G√âLULE L-CARNOSINE¬Æ
Forme : g√©lule
Enveloppe : pullulane
Allerg√®nes : aucun

Ingr√©dients :
  ‚Ä¢ L-Carnosine : 500 mg

Alias : L-CARNOSINE, L_CARNOSINE, L-CARNOSINE¬Æ

G√âLULE BETA ALANINE¬Æ
Forme : g√©lule
Enveloppe : pullulane
Allerg√®nes : aucun

Ingr√©dients :
  ‚Ä¢ B√™ta-alanine : 500 mg
  ‚Ä¢ Poudre de Spirulina platensis : 100 mg

Alias : BETA ALANINE, BETA_ALANINE, BETA ALANINE¬Æ

G√âLULE MACA¬Æ
Forme : g√©lule
Enveloppe : pullulane
Allerg√®nes : aucun

Ingr√©dients :
  ‚Ä¢ Maca (Lepidium meyenii Walp) : 1000 mg

All√©gations :
  ‚Ä¢ Le maca contribue √† une fonction sexuelle saine.

Alias : MACA, MACA¬Æ

G√âLULE STIM+¬Æ
Forme : g√©lule
Enveloppe : pullulane
Allerg√®nes : aucun

Ingr√©dients :
  ‚Ä¢ Eleutherococcus : 330 mg
  ‚Ä¢ Ginseng rouge (Panax ginseng C.) : 300 mg (dont 72 mg de gins√©nosides)
  ‚Ä¢ Damiana (Turnera diffusa W.) : 300 mg
  ‚Ä¢ Fenugrec (Trigonella foenum-graecum L.) : 300 mg
  ‚Ä¢ Extrait d'√©corce de pin sylvestre (Pinus sylvestris) : 60 mg
  ‚Ä¢ Nicotinamide (Vitamine B3) : 54 mg (337,5% VNR)
  ‚Ä¢ KaempMax (Kaempferia parviflora) : 45 mg
  ‚Ä¢ Bisglycinate de zinc : 45 mg (dont 11,25 mg de zinc = 112,5% VNR)
  ‚Ä¢ Safran (Crocus sativus L.) : 30 mg

All√©gations :
  ‚Ä¢ Le zinc contribue au maintien d'un taux normal de testost√©rone.
  ‚Ä¢ Le ginseng contribue √† la vitalit√©.

Alias : STIM+, STIM_PLUS, STIM+¬Æ

G√âLULE RELAX+¬Æ
Forme : g√©lule
Enveloppe : pullulane
Allerg√®nes : aucun

Ingr√©dients :
  ‚Ä¢ Lavande (Lavandula angustifolia) : 160 mg
  ‚Ä¢ Passiflore (Passiflora incarnata L.) : 160 mg
  ‚Ä¢ Val√©riane (Valeriana officinalis L.) : 160 mg
  ‚Ä¢ M√©lisse (Melissa officinalis) : 115,96 mg (dont acide hydroxycinnamique 20,48%, acide rosmarinique 7,26%)
  ‚Ä¢ Aub√©pine (Crataegus laevigata) : 110 mg
  ‚Ä¢ Eschscholtzia californica Cham. : 110 mg
  ‚Ä¢ GABA (acide gamma aminobutyrique) : 100 mg
  ‚Ä¢ Nicotinamide (Vitamine B3) : 36 mg (225% VNR)
  ‚Ä¢ Safran (Crocus sativus) : 30 mg (dont 12% safromotivines, 3% crocine, 2% safranal)
  ‚Ä¢ L-arginine : 30 mg

All√©gations :
  ‚Ä¢ La passiflore contribue √† un sommeil sain.
  ‚Ä¢ La val√©riane contribue √† la relaxation.

Alias : RELAX+, RELAX_PLUS, RELAX+¬Æ

G√âLULE RECUP+¬Æ
Forme : g√©lule
Enveloppe : g√©latine bovine
Allerg√®nes : g√©latine bovine

Ingr√©dients :
  ‚Ä¢ Citrate de potassium anhydre : 900 mg (dont 324 mg potassium √©l√©ment = 16,2% VNR)
  ‚Ä¢ Citrate de magn√©sium anhydre : 600 mg (dont 97,2 mg magn√©sium √©l√©ment = 25,9% VNR)

All√©gations :
  ‚Ä¢ Le magn√©sium contribue √† une fonction musculaire normale.
  ‚Ä¢ Le potassium contribue √† une fonction musculaire normale.

Alias : RECUP+, RECUP_PLUS, RECUP+¬Æ

G√âLULE CURCUM ARTI¬Æ
Forme : g√©lule
Enveloppe : pullulane
Allerg√®nes : aucun

Ingr√©dients :
  ‚Ä¢ Acujoint‚Ñ¢ : 250 mg (dont 30 mg de curcumino√Ødes, 25 mg de b√™ta-caryophyll√®ne, 12,5 mg de Bio-AKBA)
  ‚Ä¢ Curcuma (Cureit¬Æ) : 250 mg (dont 125 mg de curcumino√Ødes)
  ‚Ä¢ Extrait de Boswellia serrata : 250 mg (dont 162,5 mg d'acides boswelliques)

All√©gations :
  ‚Ä¢ Le curcuma contribue √† la sant√© des articulations.
  ‚Ä¢ La boswellia contribue √† la souplesse et au confort articulaire.

Alias : CURCUM ARTI, CURCUM_ARTI, CURCUM ARTI¬Æ

CAPSULE ONAGRE B¬Æ
Forme : capsule
Enveloppe : g√©latine
Allerg√®nes : aucun

Ingr√©dients :
  ‚Ä¢ Huile de bourrache (Borago officinalis L.) : 500 mg (dont 100 mg d'acide gamma linol√©ique GLA)
  ‚Ä¢ Huile d'onagre (Oenothera biennis L.) : 500 mg (dont 45 mg d'acide gamma linol√©ique GLA)
  ‚Ä¢ Vitamine E naturelle : 15 mg (dont 10 mg de d-Œ± tocoph√©rol = 125% VNR)

All√©gations :
  ‚Ä¢ La vitamine E contribue √† prot√©ger les cellules contre le stress oxydatif.

Alias : ONAGRE B, ONAGRE_B, ONAGRE B¬Æ

CAPSULE SKIN ACTIV¬Æ
Forme : capsule
Enveloppe : g√©latine de b≈ìuf
Allerg√®nes : gluten, g√©latine bovine

Ingr√©dients :
  ‚Ä¢ Extrait de bl√© concentr√© en phytoc√©ramides : non sp√©cifi√©
  ‚Ä¢ Oxyde de zinc : non sp√©cifi√©
  ‚Ä¢ Extrait de romarin : non sp√©cifi√©
  ‚Ä¢ Huile de graines de tournesol : non sp√©cifi√©

All√©gations :
  ‚Ä¢ Le zinc contribue au maintien d'une peau normale.

Alias : SKIN ACTIV, SKIN_ACTIV, SKIN ACTIV¬Æ

CAPSULE HEPATOP¬Æ
Forme : capsule
Enveloppe : pullulane
Allerg√®nes : aucun

Ingr√©dients :
  ‚Ä¢ Trim√©thylglycine : 240 mg
  ‚Ä¢ Phosphatidylcholine : 170 mg
  ‚Ä¢ Chlorella pyrenoidosa : 150 mg
  ‚Ä¢ Extrait de radis noir (Raphanus sativus) : 90 mg
  ‚Ä¢ Extrait d'artichaut (Cynara scolymus) : 90 mg (dont 4,5 mg de cynarine)
  ‚Ä¢ Extrait de chardon-marie (Silybum marianum) : 90 mg (dont 72 mg de silymarine)
  ‚Ä¢ N-ac√©tyl-L-cyst√©ine : 80 mg

All√©gations :
  ‚Ä¢ L'artichaut contribue √† la fonction h√©patique normale.
  ‚Ä¢ Le chardon-marie contribue √† la sant√© du foie.

Alias : HEPATOP, HEPATOP¬Æ

CAPSULE RENATOP¬Æ
Forme : capsule
Enveloppe : pullulane
Allerg√®nes : aucun

Ingr√©dients :
  ‚Ä¢ Extrait de feuille de pissenlit (Taraxacum officinale) : 200 mg (dont 6 mg de vitexine)
  ‚Ä¢ Extrait de fleur de piloselle (Hieracium pilosella) : 200 mg
  ‚Ä¢ Poudre d'Hibiscus sabdariffa : 200 mg (dont 40 mg d'acides)

All√©gations :
  ‚Ä¢ Le pissenlit contribue √† la fonction r√©nale normale.
  ‚Ä¢ La piloselle favorise l'√©limination r√©nale de l'eau.

Alias : RENATOP, RENATOP¬Æ

CAPSULE IMMUNO¬Æ
Forme : capsule
Enveloppe : pullulane
Allerg√®nes : aucun

Ingr√©dients :
  ‚Ä¢ Querc√©tine : 250 mg
  ‚Ä¢ Ginseng (Panax ginseng C.) : 150 mg (dont 36 mg de gins√©nosides)
  ‚Ä¢ Reishi (Ganoderma lucidum) : 150 mg (dont 50 mg de Œ≤-glucane)
  ‚Ä¢ Shiitake (Lentinula edodes) : 150 mg (dont 50 mg de Œ≤-(1,3/1,6)-glucane)
  ‚Ä¢ Cordyceps sinensis : 150 mg
  ‚Ä¢ Propolis Bio : 150 mg
  ‚Ä¢ Vitamine C : 90 mg (112,5% VNR)
  ‚Ä¢ Betavia‚Ñ¢ (Euglena gracilis) : 70 mg
  ‚Ä¢ Bisglycinate de Zinc : 45 mg (dont 11,25 mg de zinc = 112,5% VNR)
  ‚Ä¢ Vitamine D3 (chol√©calcif√©rol) : 50 ¬µg (1000% VNR)

All√©gations :
  ‚Ä¢ La vitamine C contribue au fonctionnement normal du syst√®me immunitaire.
  ‚Ä¢ Le zinc contribue au fonctionnement normal du syst√®me immunitaire.
  ‚Ä¢ La vitamine D contribue au fonctionnement normal du syst√®me immunitaire.

Alias : IMMUNO, IMMUNO¬Æ

G√âLULE QUERC√âTINE¬Æ
Forme : g√©lule
Enveloppe : pullulane
Allerg√®nes : aucun

Ingr√©dients :
  ‚Ä¢ Querc√©tine : 500 mg

Alias : QUERCETINE, QUERC√âTINE, QUERCETINE¬Æ

G√âLULE TEA ACTIV¬Æ
Forme : g√©lule
Enveloppe : pullulane
Allerg√®nes : trace de caf√©ine

Ingr√©dients :
  ‚Ä¢ Extrait de th√© vert (Camellia sinensis) : 500 mg (pr√©sence naturelle de caf√©ine)

All√©gations :
  ‚Ä¢ Le th√© vert contribue au m√©tabolisme des lipides.

Alias : TEA ACTIV, TEA_ACTIV, TEA ACTIV¬Æ

CAPSULE CARDIO+¬Æ
Forme : capsule
Enveloppe : g√©latine de poisson
Allerg√®nes : poisson

Ingr√©dients :
  ‚Ä¢ Om√©ga-3 (EPA + DHA) : non sp√©cifi√© (source marine)
  ‚Ä¢ Co-enzyme Q10 : non sp√©cifi√©

All√©gations :
  ‚Ä¢ L'EPA et le DHA contribuent √† une fonction cardiaque normale.

Alias : CARDIO+, CARDIO_PLUS, CARDIO+¬Æ

G√âLULE GUDZU¬Æ
Forme : g√©lule
Enveloppe : pullulane
Allerg√®nes : aucun

Ingr√©dients :
  ‚Ä¢ Kudzu (Pueraria lobata) : 1000 mg

Alias : GUDZU, KUDZU, GUDZU¬Æ

G√âLULE LACTOP¬Æ
Forme : g√©lule
Enveloppe : pullulane
Allerg√®nes : aucun

Ingr√©dients :
  ‚Ä¢ Lactase : non sp√©cifi√©

All√©gations :
  ‚Ä¢ La lactase am√©liore la digestion du lactose.

Alias : LACTOP, LACTOP¬Æ

FIN DU DOCUMENT
`;

const DATA_CURES = `
LES CURES SUPLEMINT
Version 0.9.0

R√àGLES G√âN√âRALES :
- Dur√©e d'une cure : 30 jours
- Cycle recommand√© : 3 √† 6 mois
- Pause entre les cycles : 1 mois
- Maximum de cures simultan√©es : 3
- Recommandation : 2 cures simultan√©es, id√©alement CURE THYRO√èDE + une autre

LISTE DES 21 CURES

CURE 1 : CURE THYRO√èDE
Description : Optimise le fonctionnement de ta thyro√Øde.
Moment de prise : le matin √† jeun juste avant le petit d√©jeuner
Lien : https://www.suplemint.com/products/cure-thyroide

Composition journali√®re :
  ‚Ä¢ 1x ADRENO_PLUS
  ‚Ä¢ 1x MULTI_VIT
  ‚Ä¢ 1x THYROIDE_PLUS
  ‚Ä¢ 1x L_TYRO_ACTIV

Recommand√©e pour :
  - Hypothyro√Ødie diagnostiqu√©e
  - Bilan thyro√Øde anormal
  - Fatigue constante
  - Prise de poids inexpliqu√©e
  - Frilosit√©
  - Humeur basse
  - Sommeil non r√©parateur
  - Peau s√®che / cheveux cassants
  - Transit lent
  - Gonflement visage/mains
  - Difficult√© de concentration

Contre-indications :
  - Interdiction de grossesse ou d'allaitement.
  - Interdiction traitement contre le diab√®te.
  - Interdiction des traitements anticoagulant coumariniques.
  - Interdiction en cas d'hyperthyro√Ødie.
  - D√©conseill√© en cas de maladies auto-immunes.
  - D√©conseill√© aux personnes sous traitement antid√©presseur.
  - D√©conseill√© aux enfants de moins de 12 ans.
  - D√©conseill√© en cas d'√©pilepsie.
  - D√©conseill√© en cas d'acte interventionnel invasif programm√©.

Notes :
  ‚Üí La cure essentielle et principale de chez SUPLEMINT, peut r√©soudre 70% des probl√©matiques exprim√©es dans le questionnaire QUESTION THYREN donc la proposer si ‚â• deux r√©ponses positives.
  ‚Üí En cas de maladie auto-immune de la thyro√Øde (Hashimoto ou Basedow), la cure peut √™tre recommand√©e d'apr√®s le Dr St√©phane R√©simont. Toutefois, l√©galement, il est pr√©f√©rable de prendre rendez-vous avec l'une de nos expertes (Fran√ßoise) ou votre m√©decin traitant.

CURE 2 : CURE INTESTIN
Description : Am√©liore ton transit et ta digestion.
Moment de prise : durant le repas le plus important
Lien : https://www.suplemint.com/products/cure-intestin

Composition journali√®re :
  ‚Ä¢ 1x GASTRATOP
  ‚Ä¢ 1x ENZYM_PLUS
  ‚Ä¢ 3x TRANSITEAM

Recommand√©e pour :
  - Transit lent ou constipation
  - Prise de poids inexpliqu√©e
  - Peau terne ou s√®che

Contre-indications :
  - Interdiction de grossesse ou d'allaitement.
  - D√©conseill√© aux enfants de moins de 12 ans.
  - Interdiction traitement anticoagulant coumariniques.

Notes :
  ‚Üí Cette cure en plus de son action sur la digestion et le transit est parfaite pour pr√©parer le terrain pour la cure thyro√Øde.

CURE 3 : CURE √âNERGIE
Description : Retrouve vitalit√© et tonus.
Moment de prise : le matin √† jeun juste avant le petit d√©jeuner
Lien : https://www.suplemint.com/products/cure-energie

Composition journali√®re :
  ‚Ä¢ 1x VITAMINE_C
  ‚Ä¢ 1x COQ10
  ‚Ä¢ 1x OMEGA3
  ‚Ä¢ 1x L_TYRO_ACTIV
  ‚Ä¢ 1x MAGNESIUM_PLUS

Recommand√©e pour :
  - Fatigue constante
  - Moral fluctuant
  - Difficult√© de concentration

Contre-indications :
  - Interdiction de grossesse ou d'allaitement.
  - D√©conseill√© aux enfants de moins de 12 ans.

Notes :
  ‚Üí Cette cure est parfaite pour avoir un effet 'Waouh' boost imm√©diat.

CURE 4 : CURE POIDS
Description : Facilite ta perte de poids naturellement.
Moment de prise : le matin √† jeun juste avant le petit d√©jeuner
Lien : https://www.suplemint.com/products/cure-poids

Composition journali√®re :
  ‚Ä¢ 1x COQ10
  ‚Ä¢ 2x OMEGA3
  ‚Ä¢ 1x BERBERINE_ACTIV
  ‚Ä¢ 2x ACETYL_CARN

Recommand√©e pour :
  - Prise de poids inexpliqu√©e
  - Transit lent
  - Fatigue constante

Contre-indications :
  - Interdiction de grossesse ou d'allaitement.
  - D√©conseill√© aux enfants de moins de 12 ans.
  - Interdiction traitement contre le diab√®te.

Notes :
  ‚Üí Cette cure a de super r√©sultats si elle est prise √† la suite d'INTESTIN et THYROIDE.

CURE 5 : CURE IMMUNIT√â
Description : Renforce vos d√©fenses naturelles.
Moment de prise : le matin durant le petit d√©jeuner
Lien : https://www.suplemint.com/products/cure-immunite

Composition journali√®re :
  ‚Ä¢ 3x IMMUNO
  ‚Ä¢ 1x BIO_ACTIV

Recommand√©e pour :
  - Fatigue
  - Peau s√®che
  - Transit perturb√©

Contre-indications :
  - Interdiction de grossesse ou d'allaitement.
  - D√©conseill√© aux enfants de moins de 12 ans.
  - Interdiction traitement contre le diab√®te.

CURE 6 : CURE SENIOR
Description : Accompagne le vieillissement en douceur.
Moment de prise : le matin durant le petit d√©jeuner
Lien : https://www.suplemint.com/products/cure-senior

Composition journali√®re :
  ‚Ä¢ 1x COQ10
  ‚Ä¢ 1x OMEGA3
  ‚Ä¢ 1x MULTI_VIT
  ‚Ä¢ 1x BETA_ALANINE
  ‚Ä¢ 1x L_CARNOSINE

Recommand√©e pour :
  - √Çge > 60 ans
  - Fatigue
  - Peau/cheveux fragiles

Contre-indications :
  - Interdiction de grossesse ou d'allaitement.
  - D√©conseill√© aux enfants de moins de 12 ans.
  - Interdiction traitement contre le diab√®te.
  - Interdiction des traitements anticoagulant coumariniques.
  - Interdiction probl√®mes r√©naux (goutte, calculs).

CURE 7 : CURE SOMMEIL
Description : Favorise un sommeil r√©parateur.
Moment de prise : le soir au coucher
Lien : https://www.suplemint.com/products/cure-sommeil

Composition journali√®re :
  ‚Ä¢ 3x MELATOP
  ‚Ä¢ 1x ASHWAGANDHA
  ‚Ä¢ 1x MAGNESIUM_PLUS

Recommand√©e pour :
  - Sommeil non r√©parateur
  - Humeur fluctuante

Contre-indications :
  - Interdiction de grossesse ou d'allaitement.
  - D√©conseill√© aux enfants de moins de 12 ans.
  - D√©conseill√© aux personnes sous traitement antid√©presseur.

CURE 8 : CURE COMPL√àTE
Description : Couvre l'ensemble des besoins essentiels.
Moment de prise : le matin durant le petit d√©jeuner
Lien : https://www.suplemint.com/products/cure-complete

Composition journali√®re :
  ‚Ä¢ 1x MULTI_VIT
  ‚Ä¢ 1x MAG_TOP
  ‚Ä¢ 1x PHENOL_PLUS
  ‚Ä¢ 1x ANTIOX

Recommand√©e pour :
  - Toutes r√©ponses l√©g√®rement positives sans pathologie marqu√©e

Contre-indications :
  - Interdiction de grossesse ou d'allaitement.
  - D√©conseill√© aux enfants de moins de 12 ans.
  - Interdiction traitement contre le diab√®te.
  - Interdiction des traitements anticoagulant coumariniques.
  - Interdiction probl√®mes r√©naux (goutte, calculs).
  - D√©conseill√© en cas de maladies auto-immunes.

CURE 9 : CURE HOMME+
Description : Soutient la vitalit√© masculine et la libido.
Moment de prise : le soir juste avant le d√Æner
Lien : https://www.suplemint.com/products/cure-homme

Composition journali√®re :
  ‚Ä¢ 1x COQ10
  ‚Ä¢ 1x OMEGA3
  ‚Ä¢ 3x STIM_PLUS
  ‚Ä¢ 2x MACA

Recommand√©e pour :
  - Sexe : Homme
  - Fatigue
  - Baisse motivation

Contre-indications :
  - Interdiction de grossesse ou d'allaitement.
  - D√©conseill√© aux enfants de moins de 12 ans.
  - Interdiction traitement contre le diab√®te.
  - D√©conseill√© aux personnes sous traitement antid√©presseur.

CURE 10 : CURE Z√âNITUDE
Description : Aide √† r√©duire le stress et l'anxi√©t√©.
Moment de prise : le matin durant le petit d√©jeuner
Lien : https://www.suplemint.com/products/cure-zenitude

Composition journali√®re :
  ‚Ä¢ 1x ASHWAGANDHA
  ‚Ä¢ 3x MG_MALATE
  ‚Ä¢ 2x RELAX_PLUS

Recommand√©e pour :
  - Humeur fluctuante
  - Sommeil l√©ger
  - Difficult√© de concentration

Contre-indications :
  - Interdiction de grossesse ou d'allaitement.
  - D√©conseill√© aux enfants de moins de 12 ans.
  - D√©conseill√© aux personnes sous traitement antid√©presseur.

CURE 11 : CURE D√âTOX
Description : Purifie le foie et les reins.
Moment de prise :
  - Matin √† jeun juste avant le petit d√©jeuner
  - Soir juste avant le d√Æner
Lien : https://www.suplemint.com/products/cure-detox

Composition journali√®re :
  ‚Ä¢ 2x HEPATOP (matin)
  ‚Ä¢ 2x RENATOP (soir)

Recommand√©e pour :
  - Transit lent
  - Gonflement visage/mains

Contre-indications :
  - Interdiction de grossesse ou d'allaitement.
  - D√©conseill√© aux enfants de moins de 12 ans.

CURE 12 : CURE ARTICULATION
Description : Prot√®ge et renforce vos articulations.
Moment de prise : durant le repas le plus important
Lien : https://www.suplemint.com/products/cure-articulation

Composition journali√®re :
  ‚Ä¢ 1x OMEGA3
  ‚Ä¢ 2x CURCUM_ARTI

Recommand√©e pour :
  - √Çge > 45 ans
  - Douleurs articulaires √©ventuelles

Contre-indications :
  - Interdiction de grossesse ou d'allaitement.
  - D√©conseill√© aux enfants de moins de 12 ans.
  - Interdiction des traitements anticoagulant coumariniques.
  - Interdiction en cas d'ulc√®res gastrique ou duod√©nal ou de calculs biliaires.

CURE 13 : CURE PEAU
Description : Am√©liore l'aspect et la sant√© de ta peau.
Moment de prise : durant le repas le plus important
Lien : https://www.suplemint.com/products/cure-peau

Composition journali√®re :
  ‚Ä¢ 2x ONAGRE_B
  ‚Ä¢ 1x PHENOL_PLUS
  ‚Ä¢ 1x SKIN_ACTIV

Recommand√©e pour :
  - Peau s√®che
  - Transit lent

Contre-indications :
  - Interdiction de grossesse ou d'allaitement.
  - D√©conseill√© aux enfants de moins de 12 ans.

CURE 14 : CURE M√âNOPAUSE
Description : Accompagne l'√©quilibre hormonal.
Moment de prise : le matin durant le petit d√©jeuner
Lien : https://www.suplemint.com/products/cure-menopause

Composition journali√®re :
  ‚Ä¢ 2x YAM
  ‚Ä¢ 1x OESTROBOOST
  ‚Ä¢ 3x ONAGRE_B
  ‚Ä¢ 1x MULTI_VIT
  ‚Ä¢ 1x ENZYM_PLUS

Recommand√©e pour :
  - Sexe : Femme
  - √Çge 45‚Äì60 ans
  - Humeur fluctuante
  - Sommeil perturb√©

Contre-indications :
  - Interdiction de grossesse ou d'allaitement.
  - D√©conseill√© aux enfants de moins de 12 ans.
  - D√©conseill√© en cas d'ant√©c√©dent personnel ou familial de cancers hormono-d√©pendants.
  - Interdiction des traitements anticoagulant coumariniques.

CURE 15 : CURE SPORT
Description : Soutient l'endurance et la r√©cup√©ration.
Moment de prise : juste avant l'activit√© sportive
Lien : https://www.suplemint.com/products/cure-sport

Composition journali√®re :
  ‚Ä¢ 1x KLAMATH
  ‚Ä¢ 3x RECUP_PLUS
  ‚Ä¢ 1x L_TYRO_ACTIV
  ‚Ä¢ 1x BETA_ALANINE
  ‚Ä¢ 1x L_CARNOSINE

Recommand√©e pour :
  - Bonne √©nergie
  - Pratique sportive r√©guli√®re

Contre-indications :
  - Interdiction de grossesse ou d'allaitement.
  - D√©conseill√© aux enfants de moins de 12 ans.
  - Interdiction traitement contre le diab√®te.
  - Interdiction des traitements anticoagulant coumariniques.
  - D√©conseill√© en cas de maladies auto-immunes.
  - D√©conseill√© aux personnes sous traitement antid√©presseur.

CURE 16 : CURE M√âMOIRE
Description : Stimule la concentration et la clart√© mentale.
Moment de prise : le matin durant le petit d√©jeuner
Lien : https://www.suplemint.com/products/cure-memoire

Composition journali√®re :
  ‚Ä¢ 1x KRILL
  ‚Ä¢ 1x MULTI_VIT
  ‚Ä¢ 1x MAG_TOP
  ‚Ä¢ 2x KLAMATH

Recommand√©e pour :
  - Difficult√© de concentration
  - √Çge > 45 ans

Contre-indications :
  - Interdiction de grossesse ou d'allaitement.
  - D√©conseill√© aux enfants de moins de 12 ans.
  - Interdiction traitement contre le diab√®te.
  - Interdiction des traitements anticoagulant coumariniques.
  - D√©conseill√© en cas de maladies auto-immunes.
  - D√©conseill√© aux personnes sous traitement antid√©presseur.

CURE 17 : CURE ADDICT FREE
Description : Aide √† arr√™ter de fumer.
Moment de prise : le matin √† jeun juste avant le petit d√©jeuner
Lien : https://www.suplemint.com/products/cure-addicfree

Composition journali√®re :
  ‚Ä¢ 1x OMEGA3
  ‚Ä¢ 2x L_TYRO_ACTIV
  ‚Ä¢ 2x KLAMATH
  ‚Ä¢ 4x GUDZU

Recommand√©e pour :
  - Utilisateur fumeur
  - Fatigue
  - Humeur fluctuante

Contre-indications :
  - Interdiction de grossesse ou d'allaitement.
  - D√©conseill√© aux enfants de moins de 12 ans.

CURE 18 : CURE CONCEPTION
Description : Optimise la fertilit√©.
Moment de prise : le matin durant le petit d√©jeuner
Lien : https://www.suplemint.com/products/cure-conception

Composition journali√®re :
  ‚Ä¢ 1x COQ10
  ‚Ä¢ 1x OMEGA3
  ‚Ä¢ 1x B9_4FOLIC
  ‚Ä¢ 2x MG_MALATE
  ‚Ä¢ 1x MULTI_VIT

Recommand√©e pour :
  - Projet de grossesse
  - Sexe : Femme
  - √Çge < 40

Contre-indications :
  - Interdiction de grossesse plus de 7 mois ou d'allaitement.
  - D√©conseill√© aux enfants de moins de 12 ans.
  - Interdiction traitement contre le diab√®te.
  - Interdiction des traitements anticoagulant coumariniques.
  - D√©conseill√© en cas de maladies auto-immunes.
  - D√©conseill√© aux personnes sous traitement antid√©presseur.

CURE 19 : CURE ALLAITEMENT
Description : Soutient la production de lait et l'√©nergie post-partum.
Moment de prise : le matin durant le petit d√©jeuner
Lien : https://www.suplemint.com/products/cure-allaitement

Composition journali√®re :
  ‚Ä¢ 1x OMEGA3
  ‚Ä¢ 1x MULTI_VIT
  ‚Ä¢ 2x LACTOP
  ‚Ä¢ 2x MG_MALATE

Recommand√©e pour :
  - Allaitement en cours
  - Fatigue post-partum

Contre-indications :
  - Interdiction de grossesse.
  - D√©conseill√© aux enfants de moins de 12 ans.
  - Interdiction traitement contre le diab√®te.
  - Interdiction des traitements anticoagulant coumariniques.
  - D√©conseill√© en cas de maladies auto-immunes.
  - D√©conseill√© aux personnes sous traitement antid√©presseur.

CURE 20 : CURE ANTIOXYDANT
Description : Prot√®ge du vieillissement cellulaire.
Moment de prise : le matin durant le petit d√©jeuner
Lien : https://www.suplemint.com/products/cure-antioxydant

Composition journali√®re :
  ‚Ä¢ 1x PHENOL_PLUS
  ‚Ä¢ 1x VITAMINE_C
  ‚Ä¢ 1x QUERCETINE
  ‚Ä¢ 1x TEA_ACTIV

Recommand√©e pour :
  - √Çge > 45 ans
  - Fatigue
  - Peau terne

Contre-indications :
  - Interdiction de grossesse ou d'allaitement.
  - D√©conseill√© aux enfants de moins de 12 ans.

CURE 21 : CURE CARDIO
Description : Favorise la sant√© cardiaque et circulatoire.
Moment de prise : le matin durant le petit d√©jeuner
Lien : https://www.suplemint.com/products/cure-cardio

Composition journali√®re :
  ‚Ä¢ 2x OMEGA3
  ‚Ä¢ 2x ACETYL_CARN
  ‚Ä¢ 3x CARDIO_PLUS
  ‚Ä¢ 1x COQ10

Recommand√©e pour :
  - √Çge > 60 ans
  - Frilosit√©
  - Gonflement

Contre-indications :
  - Interdiction de grossesse ou d'allaitement.
  - D√©conseill√© aux enfants de moins de 12 ans.

R√âSUM√â : CURES CONTENANT DU POISSON

Les cures suivantes contiennent des ingr√©dients d'origine marine (poisson/crustac√©s) :

1. CURE √âNERGIE (OMEGA3)
2. CURE POIDS (OMEGA3)
3. CURE SENIOR (OMEGA3)
4. CURE HOMME+ (OMEGA3)
5. CURE ARTICULATION (OMEGA3)
6. CURE M√âMOIRE (KRILL)
7. CURE ADDICT FREE (OMEGA3)
8. CURE CONCEPTION (OMEGA3)
9. CURE ALLAITEMENT (OMEGA3)
10. CURE CARDIO (OMEGA3 + CARDIO_PLUS)

FIN DU DOCUMENT
`;

const DATA_SAV = `
FAQ & SAV SUPLEMINT
Version 1.0.0

√Ä PROPOS DE SUPLEMINT

Q: Suplemint est-elle une entreprise belge ?
R: Oui. Suplemint est une entreprise 100% belge, fond√©e en 2021 par Adrien et Ma√Øt√© Chassaing.
   - Bureaux : 431H Chauss√©e de Louvain, 1380 Lasne (1er √©tage), Brabant wallon
   - Si√®ge social : 64 Chemin de Bas Ransbeck, Lasne
   - Toute la gestion, conception, conditionnement et logistique sont pilot√©es depuis la Belgique
   - Succursales au Luxembourg et en France

Q: Comment nous contacter ?
R: 
   - Email : info@suplemint.com
   - T√©l√©phone : +32 2 884 56 99 (lun-ven, 9h-19h)
   - Formulaire : www.suplemint.com/pages/contact
   - IA THYREN disponible 24/7

NOS PRODUITS & CURES

Q: Quels types de cures proposez-vous ?
R: Cures naturelles de micronutrition cibl√©e pour : thyro√Øde, √©nergie, sommeil, immunit√©, fertilit√©, digestion, m√©nopause, et plus.
   - Formules √©labor√©es avec ingr√©dients naturels
   - Actifs hautement biodisponibles
   - D√©velopp√©es avec m√©decins, pharmaciens et experts en m√©decine fonctionnelle
   - Expertise phare : Cure Thyro√Øde 2.0
   - Disponibles √† l'unit√© (1 mois), en packs multi-mois, ou par abonnement flexible
   Lien : https://www.suplemint.com/collections/trouvezvotrecure

Q: Vendez-vous les compl√©ments seuls ?
R: Oui. En plus des cures compl√®tes, nous proposons certains compl√©ments individuels :
   Melatop, CoQ10, Omega 3, Magn√©sium+, Vitamine C, Multivit
   Disponibles au mois, en plusieurs mois, ou par abonnement mensuel.
   Lien : https://www.suplemint.com/collections/trouvezvotrecure

Q: Combien de temps avant de sentir des r√©sultats ?
R: 
   - D√®s 1-2 semaines : premiers effets possibles (√©nergie, sommeil, confort digestif)
   - Apr√®s 1 mois : premiers b√©n√©fices observables mais dur√©e souvent courte pour action profonde
   - √Ä partir de 3 mois : recommandation minimale pour action compl√®te
   - 6 mois ou plus : r√©sultats durables, surtout pour thyro√Øde et √©quilibre hormonal
   La r√©gularit√© est plus importante que la perfection quotidienne.

Q: Compatibilit√© avec un traitement m√©dical ?
R: √áa d√©pend du traitement et de la cure.
   Compatible : Cure Thyro√Øde avec traitement hypothyro√Ødie (valid√© par m√©decins internes)
   Contre-indiqu√© : Cure Poids avec anticoagulants antivitamine K (anticoumariniques)
   Toujours consulter les contre-indications sur chaque page produit.
   En cas de doute, demander l'avis d'un professionnel de sant√©.

Q: Grossesse, allaitement et enfants ?
R: 
   GROSSESSE :
   - Seule Cure Conception autoris√©e
   - Arr√™t imp√©ratif avant le 7√®me mois (om√©ga-3 fluidifient le sang)
   - Toutes autres cures contre-indiqu√©es

   ALLAITEMENT :
   - Seule Cure Allaitement autoris√©e (formul√©e sp√©cifiquement)
   - Toutes autres cures contre-indiqu√©es

   ENFANTS :
   - Cures non recommand√©es avant 12 ans
   - Par s√©curit√©, utilisation pr√©conis√©e √† partir de 18 ans

Q: Quand prendre mes compl√©ments ?
R: 
   - Compl√©ments √©nergisants (√©nergie, thyro√Øde, m√©tabolisme) : le matin
   - Compl√©ments sommeil/relaxation : le soir
   - Certaines g√©lules au milieu ou fin de repas pour meilleure tol√©rance digestive

   Instructions d√©taill√©es sur :
   - Page produit
   - Dos de la bo√Æte
   - Chaque sachet
   - Carte explicative incluse (QR code)

   L'essentiel est la r√©gularit√©.

CONSEILS G√âN√âRAUX

Q: Si j'oublie de prendre une dose ?
R: Pas de panique.
   - Ne JAMAIS doubler la dose suivante
   - Sauter simplement la prise oubli√©e et reprendre normalement
   - En micronutrition, l'observance et l'endurance dans le temps sont cl√©s
   - Un oubli ponctuel n'a aucun impact significatif
   - Si plus de 30-35% des prises oubli√©es, effet moins optimal
   
   R√®gle : Un oubli = aucun souci. R√©gularit√© = r√©sultats. Dur√©e = b√©n√©fices durables.

Q: Puis-je prendre d'autres compl√©ments en plus ?
R: En th√©orie oui, mais g√©n√©ralement pas n√©cessaire. Nos cures sont d√©j√† hautement dos√©es et √©quilibr√©es.

   Si cumul :
   - V√©rifier les compositions pour √©viter doublons
   - Ne pas d√©passer doses journali√®res recommand√©es

   Vigilance particuli√®re sur :
   - Vitamine A : max 800 ¬µg/jour
   - Vitamine D : max 3000 UI/jour (75 ¬µg)
   - Vitamine E : max 300 mg/jour
   - Vitamine B6 : max 25 mg/jour
   - Fer : max 14-20 mg/jour
   - Zinc : max 25 mg/jour
   - S√©l√©nium : max 200 ¬µg/jour
   - Iode : max 150-200 ¬µg/jour
   - Om√©ga-3 : max 3 g/jour sans avis m√©dical

Q: Qu'est-ce qui justifie le prix des cures ?
R: 
   - Qualit√© des mati√®res premi√®res (actifs premium, biodisponibles, brevet√©s)
   - Complexit√© des formules (plusieurs compl√©ments combin√©s pour action 360¬∞)
   - Travail d'experts (m√©decins, pharmaciens, sp√©cialistes m√©decine fonctionnelle)
   - Suivi scientifique r√©gulier

   Exemple Cure Thyro√Øde :
   - √âquivalent en compl√©ments s√©par√©s = 343‚Ç¨
   - Pack Suplemint = 125‚Ç¨
   - √âconomie de 218‚Ç¨

ALLERGIES & TYPES D'ALIMENTATION

Q: Sans gluten et sans lactose ?
R: Aucun gluten ni lactose ajout√©s, SAUF Cure Peau (g√©lule SKIN ACTIV peut en contenir).

   Attention : fabrication dans installations multi-produits manipulant aussi bl√©, soja, lactose, ma√Øs, oeuf, poisson, crustac√©s, fruits √† coque, arachides, gluten. Contamination crois√©e possible.
   Si allergie s√©v√®re : consulter m√©decin et v√©rifier liste ingr√©dients.

Q: Allerg√®ne poisson & d√©riv√©s marins ?
R: Cures contenant poisson/d√©riv√©s marins (om√©ga-3, krill) :
   1. Cure √ânergie
   2. Cure Poids
   3. Cure Immunit√©
   4. Cure Senior
   5. Cure M√©moire (krill + om√©ga-3)
   6. Cure Homme+
   7. Cure Cardio
   8. Cure Articulation
   9. Cure Addict Free
   10. Cure Conception
   11. Cure Allaitement

   Aucune autre cure ne contient d'ingr√©dients marins.
   Avis m√©dical indispensable si allergie poisson ou crustac√©s.

Q: V√©g√©tarien ou v√©g√©talien ?
R: Selon les formules : certaines cures v√©g√©tariennes, d'autres contiennent om√©ga-3 issus d'huile de poisson (certifi√©s p√™che durable).
   - Actuellement, aucune cure 100% v√©g√©talienne
   - Information v√©g√©tarien/non v√©g√©tarien pr√©cis√©e dans description produit

PAIEMENT

Q: Moyens de paiement accept√©s ?
R: 
   En ligne :
   - Apple Pay
   - Carte de cr√©dit
   - PayPal
   - Bancontact
   - iDEAL
   - Klarna

   Sur place :
   - Terminal bancaire
   - Esp√®ces (cash)

   Tous paiements trait√©s via solutions s√©curis√©es conformes aux standards.

Q: Comment utiliser un code promotionnel ?
R: 
   1. Ajouter produits au panier
   2. Page de paiement
   3. Entrer code dans le champ pr√©vu avant paiement

   Un seul code √† la fois (le plus avantageux appliqu√© automatiquement)
   Codes cumulables avec r√©ductions automatiques :
   - -15% abonnements
   - -10% d√®s 2 produits
   - -15% d√®s 3 produits

Q: Mon code ne fonctionne pas ?
R: Possible si :
   - Code d√©j√† utilis√©
   - Code expir√©
   - Code non applicable aux produits du panier
   Si code valide selon vous, contacter info@suplemint.com pour v√©rification.

COMMANDES & EXP√âDITIONS

Q: D√©lais de livraison ?
R: 
   - Benelux : 2-3 jours ouvr√©s (GLS)
   - France : 2-5 jours ouvr√©s (GLS)
   - Suisse (DAP) : 3-6 jours ouvr√©s (Bpost, aucun frais de douane)
   - Europe : 3-6 jours ouvr√©s (Bpost)
   - USA : 4-6 jours ouvr√©s (Bpost)
   - International : 6-12 jours ouvr√©s (Bpost)

   En cas d'absence : d√©p√¥t en point relais le plus proche.

Q: Comment v√©rifier le statut de ma commande ?
R: Apr√®s commande : email de confirmation, puis emails de suivi (pr√©par√©, exp√©di√©, en cours de livraison, livr√©).
   Chaque email contient lien de suivi (tracking).
   Suivi Shopify et suivi transporteur peuvent diff√©rer l√©g√®rement, attendre 24h pour synchronisation.

Q: Ma commande est en retard ?
R: 
   1. V√©rifier le tracking via lien email
   2. V√©rifier spams/ind√©sirables
   
   Si retard pr√©visible connu (f√™tes, etc.), nous informons par email.
   Si retard > 5 jours ouvrables : contacter info@suplemint.com avec num√©ro de commande, ou appeler +32 2 884 56 99.

Q: Annuler ma commande ?
R: Possible tant que colis non exp√©di√©.
   - Commandes avant 11h : exp√©di√©es le jour m√™me
   - Commandes apr√®s 11h : exp√©di√©es le lendemain
   Contacter rapidement info@suplemint.com ou +32 2 884 56 99.
   Apr√®s exp√©dition : retour possible sous 14 jours.

Q: Modifier ma commande ?
R: Possible avant exp√©dition (ajouter/retirer produit, modifier cure).
   Contacter rapidement info@suplemint.com ou +32 2 884 56 99.

Q: Mauvais produit ou produit endommag√© ?
R: Contacter info@suplemint.com ou +32 2 884 56 99 avec :
   - Num√©ro de commande
   - Photo du produit re√ßu/endommag√©
   Solution : remplacement ou renvoi.

ABONNEMENT

Q: Avantages de l'abonnement ?
R: 
   - -15% sur le prix total
   - Livraison offerte
   - Pilulier offert (1√®re commande)
   - Suivi mensuel offert avec nutritionniste
   - Envoi automatique tous les 30 jours
   - Sans engagement, annulable √† tout moment

CODES PROMOTIONNELS ACTIFS

Code : STANARNOW10
Offre : -10% √† l'inscription newsletter
Conditions : Nouveaux inscrits uniquement

Code : JANVIER30
Offre : -30% sur chaque commande
Conditions : Valable janvier 2026 uniquement

RENDEZ-VOUS & ACCOMPAGNEMENT

Q: Comment prendre rendez-vous avec un expert ?
R: Nos nutritionnistes sont disponibles pour un √©change gratuit et personnalis√©.
   Prendre rendez-vous via : https://app.cowlendar.com/cal/67d2de1f5736e38664589693/54150414762252

FIN DU DOCUMENT
`;

console.log("‚úÖ THYREN V29 - FIX POST-QUIZ + RENDEZ-VOUS CLIQUABLE + 3-5 CTA");

function validateEmail(email) {
  const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  return re.test(email);
}

function validateName(name) {
  return name.length >= 2 && /^[a-zA-Z√Ä-√ø\s-]+$/.test(name);
}

function isInvalidResponse(value, type) {
  const val = value.toLowerCase().trim();
  
  if (type === "prenom") {
    const badNames = ["hitler", "trump", "macron", "poutine", "staline", "mussolini", "test", "toto", "tata"];
    if (badNames.some(bad => val.includes(bad))) return true;
    return !validateName(value) || val.length < 2 || /^(.)\1+$/.test(val) || val === "aa" || val === "aaa";
  }
  
  if (type === "email") {
    return !validateEmail(value);
  }
  
  if (type === "condition_detail" || type.endsWith("_detail")) {
    const badWords = ["caca", "pipi", "merde", "connard", "salope", "putin", "fuck", "shit"];
    const veryShort = val.length < 4;
    const hasBadWord = badWords.some(bad => val.includes(bad));
    const invalidPhrases = ["rien", "nan", "non", "aucun", "???", "...", "idk", "jsp"];
    const tooVague = invalidPhrases.some(phrase => val === phrase) || /^[a-z]{1,3}$/.test(val);
    
    return hasBadWord || (veryShort && tooVague);
  }
  
  return false;
}

function extractNameFromConversation(messages) {
  for (const msg of messages) {
    if (msg.role !== "user") continue;
    const content = typeof msg.content === "string" ? msg.content : "";
    const lower = content.toLowerCase();
    
    const patterns = [
      /je m'appelle ([a-zA-Z√Ä-√ø]+)/i,
      /mon pr√©nom est ([a-zA-Z√Ä-√ø]+)/i,
      /c'est ([a-zA-Z√Ä-√ø]+)/i,
      /^([a-zA-Z√Ä-√ø]{3,15})$/i,
    ];
    
    for (const pattern of patterns) {
      const match = content.match(pattern);
      if (match && validateName(match[1])) {
        return match[1].charAt(0).toUpperCase() + match[1].slice(1).toLowerCase();
      }
    }
  }
  return null;
}

// üî• NOUVELLE FONCTION : Enregistrer l'email dans Klaviyo
// üî• FONCTION KLAVIYO COMPL√àTE
async function sendToKlaviyo(profileData) {
  const KLAVIYO_API_KEY = process.env.KLAVIYO_API_KEY;
  const KLAVIYO_LIST_ID = process.env.KLAVIYO_LIST_ID;
  
  console.log("üîç KLAVIYO_API_KEY pr√©sent:", !!KLAVIYO_API_KEY);
  console.log("üîç KLAVIYO_LIST_ID pr√©sent:", !!KLAVIYO_LIST_ID);
  console.log("üîç KLAVIYO_LIST_ID valeur:", KLAVIYO_LIST_ID);
  
  if (!KLAVIYO_API_KEY) {
    console.error("‚ùå Klaviyo API key missing");
    return { success: false, error: "API key missing" };
  }

  try {
    const properties = {
      first_name: profileData.prenom || "",
      age_range: profileData.age || "",
      gender: profileData.sexe || "",
      medical_condition: profileData.condition || "",
      medical_condition_detail: profileData.condition_detail || "",
      is_pregnant: profileData.enceinte || "Non",
      main_goal: profileData.objectif || "",
      goal_detail: profileData.plainte || "",
      energy_level: profileData.energie || "",
      weight_status: profileData.poids || "",
      cold_sensitivity: profileData.froid || "",
      mood_status: profileData.humeur || "",
      sleep_quality: profileData.sommeil || "",
      skin_hair_status: profileData.peau || "",
      digestion_status: profileData.transit || "",
      swelling_status: profileData.gonflement || "",
      concentration_status: profileData.concentration || "",
      libido_status: profileData.libido || "",
      quiz_completed_at: new Date().toISOString(),
      quiz_version: "v30",
      source: "THYREN_QUIZ"
    };

    console.log("üìß Cr√©ation profil pour:", profileData.email);

    // √âTAPE 1 : Cr√©er/mettre √† jour le profil
    const profileResponse = await fetch("https://a.klaviyo.com/api/profiles/", {
      method: "POST",
      headers: {
        "Authorization": `Klaviyo-API-Key ${KLAVIYO_API_KEY}`,
        "Content-Type": "application/json",
        "revision": "2023-10-15"
      },
      body: JSON.stringify({
        data: {
          type: "profile",
          attributes: {
            email: profileData.email,
            properties: properties
          }
        }
      })
    });

    if (!profileResponse.ok) {
      const errorText = await profileResponse.text();
      console.error("‚ùå Klaviyo profile error:", profileResponse.status, errorText);
      return { success: false, error: errorText };
    }

    const profileDataResponse = await profileResponse.json();
    const profileId = profileDataResponse.data.id;
    console.log("‚úÖ Profil cr√©√©:", profileData.email, "| ID:", profileId);

    // √âTAPE 2 : Subscribe le profil avec consentement marketing
    if (KLAVIYO_LIST_ID) {
      console.log("üìù Subscription marketing √† la liste:", KLAVIYO_LIST_ID);
      
      const subscribeResponse = await fetch(`https://a.klaviyo.com/api/profile-subscription-bulk-create-jobs/`, {
        method: "POST",
        headers: {
          "Authorization": `Klaviyo-API-Key ${KLAVIYO_API_KEY}`,
          "Content-Type": "application/json",
          "revision": "2023-10-15"
        },
        body: JSON.stringify({
          data: {
            type: "profile-subscription-bulk-create-job",
            attributes: {
              profiles: {
                data: [
                  {
                    type: "profile",
                    id: profileId,
                    attributes: {
                      email: profileData.email,
                      subscriptions: {
                        email: {
                          marketing: {
                            consent: "SUBSCRIBED"
                          }
                        }
                      }
                    }
                  }
                ]
              }
            },
            relationships: {
              list: {
                data: {
                  type: "list",
                  id: KLAVIYO_LIST_ID
                }
              }
            }
          }
        })
      });

      console.log("üìä Statut subscription:", subscribeResponse.status);

      if (subscribeResponse.ok) {
        console.log("‚úÖ Profil abonn√© marketing");
      } else {
        const errorText = await subscribeResponse.text();
        console.error("‚ö†Ô∏è √âchec subscription:", subscribeResponse.status, errorText);
      }
    } else {
      console.warn("‚ö†Ô∏è KLAVIYO_LIST_ID manquant - profil NON abonn√©");
    }

    return { success: true, data: profileDataResponse };

  } catch (error) {
    console.error("‚ùå Klaviyo exception:", error);
    return { success: false, error: error.message };
  }
}
function isPostQuizResponse(messages) {
  // Parcourir les 10 derniers messages pour d√©tecter les r√©sultats
  const recentMessages = messages.slice(-10);
  
  for (let i = recentMessages.length - 1; i >= 0; i--) {
    const msg = recentMessages[i];
    if (msg.role !== "assistant") continue;
    
    try {
      const content = typeof msg.content === "string" ? msg.content : "";
      
      // M√©thode 1 : Parser le JSON
      try {
        const parsed = JSON.parse(content);
        if (parsed.type === "resultat") {
          return true;
        }
      } catch {}
      
      // M√©thode 2 : D√©tecter les marqueurs textuels des r√©sultats
      if (content.includes("===BLOCK===") || 
          content.includes("Cure ") && content.includes("¬Æ") ||
          content.includes("Premiers effets possibles") ||
          content.includes("R√©sultats optimaux")) {
        return true;
      }
    } catch (err) {
      console.error("Error checking post-quiz:", err);
    }
  }
  return false;
}

const QUIZ = [
  {
    id: "Q1",
    text: "Parfait, trouvons ensemble la cure id√©ale. Pour commencer, quel est votre pr√©nom ?",
    type: "open",
    key: "prenom",
    validate: true
  },
  {
    id: "Q2",
    text: "Merci {prenom} ! Quel est votre √¢ge ?",
    type: "choice",
    choices: ["Moins de 30 ans", "30-45 ans", "45-60 ans", "Plus de 60 ans"],
    key: "age"
  },
  {
    id: "Q3",
    text: "Parfait {prenom}, quel est votre sexe biologique ?",
    type: "choice",
    choices: ["Femme", "Homme"],
    key: "sexe"
  },
  {
    id: "Q3_plus",
    text: "√ätes-vous actuellement enceinte ou allaitante ?",
    type: "choice",
    choices: ["Oui", "Non"],
    key: "enceinte",
    cond: a => a.sexe === "Femme"
  },
  {
    id: "Q4_menopause",
    text: "Concernant votre cycle hormonal, o√π en √™tes-vous ?",
    type: "choice",
    choices: [
      "Oui, je suis m√©nopaus√©e",
      "Oui, j'ai des sympt√¥mes de pr√©m√©nopause ou m√©nopause",
      "Non, je n'ai pas de sympt√¥mes particuliers",
      "Autre ‚Äì j'aimerais pr√©ciser"
    ],
    key: "menopause",
    cond: a => a.sexe === "Femme" && (a.age === "45-60 ans" || a.age === "Plus de 60 ans")
  },
  {
    id: "Q5",
    text: "Avez-vous une condition m√©dicale, une allergie ou prenez-vous un traitement ou des compl√©ments ?",
    type: "choice",
    choices: ["Tout va bien", "Oui, j'ai une condition / allergie / traitement"],
    key: "condition"
  },
  {
    id: "Q5b",
    text: "Merci de pr√©ciser votre condition, allergie ou traitement (c'est important pour votre s√©curit√©).",
    type: "open",
    key: "condition_detail",
    cond: a => a.condition !== "Tout va bien",
    validate: true
  },
  {
    id: "Q6_objectif",
    text: "Bien not√© {prenom}. Quel est votre objectif principal avec une cure ?",
    type: "choice",
    choices: [
      "Retrouver de l'√©nergie",
      "Perdre du poids / relancer le m√©tabolisme",
      "Mieux dormir",
      "R√©duire le stress / l'anxi√©t√©",
      "Am√©liorer ma digestion / transit",
      "Am√©liorer mon √©quilibre hormonal",
      "Autre ‚Äì j'aimerais pr√©ciser"
    ],
    key: "objectif"
  },
  {
    id: "Q6_objectif_autre",
    text: "Merci de pr√©ciser votre objectif en quelques mots.",
    type: "open",
    key: "plainte",
    cond: a => a.objectif?.startsWith("Autre")
  },
  {
    id: "Q7_energie",
    text: "Parlons maintenant de votre √©nergie au quotidien. Comment la d√©cririez-vous ?",
    type: "choice",
    choices: [
      "Bonne √©nergie tout au long de la journ√©e",
      "Fatigue l√©g√®re ou passag√®re",
      "Fatigue constante malgr√© le repos",
      "Autre ‚Äì j'aimerais pr√©ciser"
    ],
    key: "energie"
  },
  {
    id: "Q7_energie_autre",
    text: "Merci de pr√©ciser comment vous d√©cririez votre niveau d'√©nergie.",
    type: "open",
    key: "energie_detail",
    cond: a => a.energie?.startsWith("Autre")
  },
  {
    id: "Q8_poids",
    text: "Avez-vous pris du poids r√©cemment sans changer votre alimentation ?",
    type: "choice",
    choices: [
      "Non, mon poids est stable",
      "Oui, une l√©g√®re prise de poids",
      "Oui, une prise de poids importante ou inexpliqu√©e",
      "Autre ‚Äì j'aimerais pr√©ciser"
    ],
    key: "poids"
  },
  {
    id: "Q8_poids_autre",
    text: "Merci de pr√©ciser votre situation concernant le poids.",
    type: "open",
    key: "poids_detail",
    cond: a => a.poids?.startsWith("Autre")
  },
  {
    id: "Q9_froid",
    text: "Avez-vous souvent froid, notamment aux mains ou aux pieds ?",
    type: "choice",
    choices: [
      "Non, temp√©rature normale",
      "Parfois",
      "Souvent, m√™me quand il fait bon",
      "Autre ‚Äì j'aimerais pr√©ciser"
    ],
    key: "froid"
  },
  {
    id: "Q9_froid_autre",
    text: "Merci de pr√©ciser comment vous ressentez le froid.",
    type: "open",
    key: "froid_detail",
    cond: a => a.froid?.startsWith("Autre")
  },
  {
    id: "Q10_humeur",
    text: "Comment d√©cririez-vous votre humeur ces derni√®res semaines ?",
    type: "choice",
    choices: [
      "Moral stable",
      "Humeur fluctuante",
      "Moral bas",
      "Autre ‚Äì j'aimerais pr√©ciser"
    ],
    key: "humeur"
  },
  {
    id: "Q10_humeur_autre",
    text: "Merci de pr√©ciser votre humeur.",
    type: "open",
    key: "humeur_detail",
    cond: a => a.humeur?.startsWith("Autre")
  },
  {
    id: "Q11_sommeil",
    text: "Parlons de votre sommeil. Vous sentez-vous repos√©(e) au r√©veil ?",
    type: "choice",
    choices: [
      "Oui, je dors bien",
      "Sommeil parfois l√©ger ou agit√©",
      "Difficult√©s √† dormir ou fatigue au r√©veil",
      "Autre ‚Äì j'aimerais pr√©ciser"
    ],
    key: "sommeil"
  },
  {
    id: "Q11_sommeil_autre",
    text: "Merci de pr√©ciser comment se passe votre sommeil.",
    type: "open",
    key: "sommeil_detail",
    cond: a => a.sommeil?.startsWith("Autre")
  },
  {
    id: "Q12_peau",
    text: "Avez-vous remarqu√© des changements au niveau de votre peau ou de vos cheveux ?",
    type: "choice",
    choices: [
      "Non, tout est normal",
      "Peau un peu s√®che ou cheveux ternes",
      "Peau tr√®s s√®che ou cheveux cassants",
      "Autre ‚Äì j'aimerais pr√©ciser"
    ],
    key: "peau"
  },
  {
    id: "Q12_peau_autre",
    text: "Merci de pr√©ciser les changements observ√©s.",
    type: "open",
    key: "peau_detail",
    cond: a => a.peau?.startsWith("Autre")
  },
  {
    id: "Q13_transit",
    text: "Comment fonctionne votre syst√®me digestif au quotidien ?",
    type: "choice",
    choices: [
      "Transit r√©gulier",
      "Parfois un peu lent",
      "Constipation ou digestion difficile",
      "Autre ‚Äì j'aimerais pr√©ciser"
    ],
    key: "transit"
  },
  {
    id: "Q13_transit_autre",
    text: "Merci de pr√©ciser votre transit.",
    type: "open",
    key: "transit_detail",
    cond: a => a.transit?.startsWith("Autre")
  },
  {
    id: "Q14_gonflement",
    text: "Avez-vous remarqu√© un gonflement du visage ou des mains le matin ?",
    type: "choice",
    choices: [
      "Non",
      "Parfois",
      "Oui, visible chaque matin",
      "Autre ‚Äì j'aimerais pr√©ciser"
    ],
    key: "gonflement"
  },
  {
    id: "Q14_gonflement_autre",
    text: "Merci de pr√©ciser les gonflements observ√©s.",
    type: "open",
    key: "gonflement_detail",
    cond: a => a.gonflement?.startsWith("Autre")
  },
  {
    id: "Q15_concentration",
    text: "Comment √©valueriez-vous votre concentration et votre clart√© mentale ?",
    type: "choice",
    choices: [
      "Concentration normale",
      "L√©g√®re distraction",
      "Brouillard mental",
      "Autre ‚Äì j'aimerais pr√©ciser"
    ],
    key: "concentration"
  },
  {
    id: "Q15_concentration_autre",
    text: "Merci de pr√©ciser vos difficult√©s de concentration.",
    type: "open",
    key: "concentration_detail",
    cond: a => a.concentration?.startsWith("Autre")
  },
  {
    id: "Q16_libido",
    text: "Derni√®re question sur votre sant√© : avez-vous remarqu√© un changement de votre libido ?",
    type: "choice",
    choices: [
      "Aucun changement notable",
      "Libido variable",
      "Libido tr√®s basse",
      "Autre ‚Äì j'aimerais pr√©ciser"
    ],
    key: "libido"
  },
  {
    id: "Q16_libido_autre",
    text: "Merci de pr√©ciser les changements de libido.",
    type: "open",
    key: "libido_detail",
    cond: a => a.libido?.startsWith("Autre")
  },
  {
    id: "Q17_email",
    text: "Parfait {prenom}, nous avons termin√© ! Pour recevoir vos r√©sultats personnalis√©s, quelle est votre adresse e-mail ?",
    type: "open",
    key: "email",
    validate: true
  }
];

function getQuizState(messages) {
  let step = -1;
  let answers = {};

  for (const msg of messages) {
    const content = typeof msg.content === "string" ? msg.content : JSON.stringify(msg.content);

    if (msg.role === "assistant") {
      try {
        const parsed = JSON.parse(content);
        if (typeof parsed.meta?.quizStep === "number") {
          step = parsed.meta.quizStep;
        }
        if (parsed.meta?.answers) {
          answers = { ...answers, ...parsed.meta.answers };
        }
      } catch {}
    }

    if (msg.role === "user" && step >= 0 && QUIZ[step]) {
      answers[QUIZ[step].key] = content.trim();
    }
  }

  return { step, answers };
}

function nextStep(step, answers) {
  let n = step + 1;
  while (n < QUIZ.length && QUIZ[n].cond && !QUIZ[n].cond(answers)) {
    n++;
  }
  return n;
}

function buildPersonalizedPreface(step, answers) {
  if (step <= 0) return "";
  const prevQ = QUIZ[step - 1];
  if (!prevQ) return "";
  const prevAnswer = answers[prevQ.key];
  if (!prevAnswer || !prevQ.key.endsWith("_detail")) return "";
  const prenom = answers.prenom || "";
  const transitions = [
    `Not√©. `,
    `Merci pour ces pr√©cisions. `,
    `Bien re√ßu. `,
    `C'est not√©. `,
    `Merci ${prenom}. `,
    `Compris. `,
  ];
  const index = step % transitions.length;
  return transitions[index];
}

function buildQuestion(step, answers) {
  const q = QUIZ[step];
  const preface = buildPersonalizedPreface(step, answers);
  let text = q.text.replace(/{prenom}/g, answers.prenom || "");
  if (preface) text = preface + text;

  const response = {
    type: "question",
    text: text,
    meta: {
      mode: "A",
      quizStep: step,
      answers: answers,
      progress: {
        enabled: true,
        current: step + 1,
        total: 17,
      },
    },
  };

  if (q.type === "choice") {
    response.choices = q.choices;
  }

  return response;
}

export default async function handler(req, res) {
  res.setHeader("Access-Control-Allow-Origin", req.headers.origin || "*");
  res.setHeader("Access-Control-Allow-Methods", "POST, OPTIONS");
  res.setHeader("Access-Control-Allow-Headers", "Content-Type");

  if (req.method === "OPTIONS") return res.status(204).end();
  if (req.method !== "POST") return res.status(405).json({ error: "Method Not Allowed" });

  try {
    const { messages, conversationId } = req.body || {};
    if (!Array.isArray(messages)) return res.status(400).json({ error: "messages required" });

    const KEY = process.env.OPENAI_API_KEY;
    if (!KEY) return res.status(500).json({ error: "API key missing" });

    const lastMsg = messages.filter((m) => m.role === "user").pop()?.content || "";
    const userText = typeof lastMsg === "object" ? lastMsg.text || "" : String(lastMsg);
    const lower = userText.toLowerCase();

    // D√âTECTION POST-QUIZ EN PREMIER (pour √©viter validation email incorrecte)
    const isPostQuiz = isPostQuizResponse(messages);
    
    const isQuizTrigger = /(^|\b)(quiz|cure ideale|cure id√©ale|trouver ma cure|trouver ma cure id√©ale|je veux faire le quiz|faire le quiz|oui|ok|go|commen√ßons|commence|on y va|c'est parti|allons-y)(\b|$)/i.test(userText);
    const isQuestionTrigger = /(^|\b)(j'ai une question|jai une question|question|peux-tu|peux tu|comment|pourquoi|combien|quand|o√π)(\b|$)/i.test(lower);

    let isQuiz = isQuizTrigger && !isPostQuiz; // Exclure post-quiz du mode quiz
    
    const previousMsg = messages.slice(-3, -1);
    for (const m of previousMsg) {
      const content = typeof m.content === "string" ? m.content : "";
      if (m.role === "assistant" && /quiz|recommandation personnalis√©e/i.test(content)) {
        if (/(^|\b)(oui|ok|go|commen√ßons|commence|d'accord|dacord)(\b|$)/i.test(lower)) {
          isQuiz = true && !isPostQuiz;
          break;
        }
      }
    }
    
    if (!isPostQuiz) {
      for (const m of messages) {
        try {
          const parsed = JSON.parse(typeof m.content === "string" ? m.content : "{}");
          if (parsed.meta?.mode === "A") isQuiz = true;
        } catch {}
      }
    }

    if (isQuiz) {
      const state = getQuizState(messages);
      
      const detectedName = extractNameFromConversation(messages);
      if (detectedName && !state.answers.prenom && state.step === -1) {
        state.answers.prenom = detectedName;
        const next = 1;
        return res.status(200).json({
          reply: buildQuestion(next, state.answers),
          conversationId,
          mode: "A",
        });
      }

      if (state.step >= 0 && QUIZ[state.step]) {
        const currentQ = QUIZ[state.step];
        
        if (currentQ.type === "open") {
          const validationType = currentQ.validate ? currentQ.key : (currentQ.key.endsWith("_detail") ? currentQ.key : null);
          
          if (validationType && isInvalidResponse(userText, validationType)) {
            const errorMessages = {
              "prenom": "Hmm, ce pr√©nom ne semble pas s√©rieux ! Peux-tu me donner ton vrai pr√©nom ? C'est important pour personnaliser ton accompagnement.",
              "email": "Cette adresse e-mail ne semble pas valide. Peux-tu la v√©rifier ?",
              "default": "Cette r√©ponse ne me semble pas compl√®te ou s√©rieuse. Peux-tu reformuler en quelques mots clairs ? C'est essentiel pour ton bien-√™tre."
            };
            
            return res.status(200).json({
              reply: {
                type: "question",
                text: errorMessages[currentQ.key] || errorMessages["default"],
                meta: {
                  mode: "A",
                  quizStep: state.step,
                  answers: state.answers,
                  progress: { enabled: true, current: state.step + 1, total: 17 },
                },
              },
              conversationId,
              mode: "A",
            });
          }
        }
        
        state.answers[currentQ.key] = userText.trim();
      }

      const next = state.step < 0 ? 0 : nextStep(state.step, state.answers);

if (next >= QUIZ.length) {
  // üî• NOUVEAU: Enregistrer l'email dans Klaviyo AVANT de g√©n√©rer les r√©sultats
  console.log("üìß Envoi du profil √† Klaviyo...");
  const klaviyoResult = await sendToKlaviyo(state.answers);

  if (klaviyoResult.success) {
    console.log("‚úÖ Profil enregistr√© dans Klaviyo");
  } else {
    console.error("‚ö†Ô∏è √âchec Klaviyo (quiz continue):", klaviyoResult.error);
    // On continue le quiz m√™me si Klaviyo √©choue
  }

  const today = new Date();
  const fmt = (d) =>
    d.getDate().toString().padStart(2, "0") + "/" +
    (d.getMonth() + 1).toString().padStart(2, "0") + "/" +
    d.getFullYear();

  const j14 = fmt(new Date(today.getTime() + 14 * 86400000));
  const j90 = fmt(new Date(today.getTime() + 90 * 86400000));
  const a = state.answers;     
  const prompt = `Tu es Dr THYREN, expert m√©dical en micronutrition chez SUPLEMINT.

PROFIL COMPLET:
- Pr√©nom: ${a.prenom}
- Sexe: ${a.sexe}
- √Çge: ${a.age}
- Grossesse/Allaitement: ${a.enceinte || "Non"}
- Condition/Traitement: ${a.condition} ${a.condition_detail || ""}
- Objectif principal: ${a.objectif || a.plainte}

BILAN SYMPTOMATIQUE:
- √ânergie: ${a.energie} ${a.energie_detail || ""}
- Poids: ${a.poids} ${a.poids_detail || ""}
- Frilosit√©: ${a.froid} ${a.froid_detail || ""}
- Humeur: ${a.humeur} ${a.humeur_detail || ""}
- Sommeil: ${a.sommeil} ${a.sommeil_detail || ""}
- Peau/Cheveux: ${a.peau} ${a.peau_detail || ""}
- Transit: ${a.transit} ${a.transit_detail || ""}
- Gonflement: ${a.gonflement} ${a.gonflement_detail || ""}
- Concentration: ${a.concentration} ${a.concentration_detail || ""}
- Libido: ${a.libido} ${a.libido_detail || ""}

DATES CL√âS:
- Date J+14: ${j14}
- Date J+90: ${j90}

DONN√âES CURES DISPONIBLES:
${DATA_CURES}

R√àGLES DE S√âCURIT√â ABSOLUES:
Avant de recommander une cure, tu DOIS v√©rifier les contre-indications :
- Grossesse/allaitement ‚Üí AUCUNE cure sauf Conception (avant 7 mois) ou Allaitement
- Diab√®te ‚Üí INTERDIT : Poids, Immunit√©, Senior, Homme+, Sport, M√©moire, Conception, Allaitement
- Anticoagulants ‚Üí INTERDIT : Intestin, Senior, Articulation, M√©nopause, Sport, M√©moire, Conception, Allaitement
- Antid√©presseurs ‚Üí INTERDIT : Thyro√Øde, Sommeil, Homme+, Z√©nitude, Sport, M√©moire
- Allergie poisson ‚Üí INTERDIT toutes cures avec OMEGA3 ou KRILL
Si une cure est contre-indiqu√©e pour le profil, ne JAMAIS la recommander.

ANALYSE INTELLIGENTE:
Identifie les patterns comme un m√©decin :
- Fatigue + frilosit√© + poids + transit lent = hypothyro√Ødie probable ‚Üí CURE THYRO√èDE
- Fatigue sans autres sympt√¥mes marqu√©s ‚Üí CURE √âNERGIE
- Transit probl√©matique ‚Üí CURE INTESTIN (pr√©pare le terrain)
- Troubles du sommeil dominants ‚Üí CURE SOMMEIL
- Stress/anxi√©t√© dominants ‚Üí CURE Z√âNITUDE
- Femme 45-60 ans + sympt√¥mes hormonaux ‚Üí CURE M√âNOPAUSE

INSTRUCTION DE SORTIE:
Tu dois produire un JSON avec EXACTEMENT ce format (5 blocs s√©par√©s par "===BLOCK==="):

{
  "type":"resultat",
  "text":"BLOC1===BLOCK===BLOC2===BLOCK===BLOC3===BLOCK===BLOC4===BLOCK===BLOC5",
  "appointment_url":"https://app.cowlendar.com/cal/67d2de1f5736e38664589693/54150414762252",
  "meta":{"mode":"A"}
}

STRUCTURE OBLIGATOIRE DES BLOCS:

BLOC 1 - DIAGNOSTIC M√âDICAL (3-4 phrases naturelles et empathiques):
Bonjour ${a.prenom}, votre profil r√©v√®le [m√©canisme physiopathologique principal en 1 phrase]. [Lien entre 2-3 sympt√¥mes cl√©s montrant interconnexion]. [Impact concret sur le quotidien]. Cette situation est r√©versible avec une approche micronutritionnelle cibl√©e.

BLOC 2 - CURE PRINCIPALE (FORMAT EXACT - ATTENTION AUX CTA):
Cure [NOM EXACT]¬Æ
https://www.suplemint.com/products/[handle]

[Explication intelligente du POURQUOI cette cure pour CE profil sp√©cifique - 2-3 phrases]

Composition (par jour) :
1√ó [NOM_EXACT]¬Æ + 1√ó [NOM_EXACT]¬Æ + [etc]

üìÖ Premiers effets possibles d√®s le ${j14}
üìÖ R√©sultats optimaux vers le ${j90}

ATTENTION CTA : Termine BLOC 2 ici. Ne PAS √©crire "Commander ma cure" ni "Ajouter au panier" ni "En savoir plus" - ces boutons sont ajout√©s automatiquement par le frontend.

BLOC 3 - CURE COMPL√âMENTAIRE (m√™me format que BLOC 2, OU "Aucune cure compl√©mentaire n√©cessaire pour le moment" si pas pertinent)

BLOC 4 - RENDEZ-VOUS EXPERT (FORMAT EXACT):
La vraie force d'une cure r√©side dans sa personnalisation. Nos nutritionnistes sont disponibles d√®s aujourd'hui pour un √©change offert par t√©l√©phone ou visio.

NOTE: L'URL de rendez-vous sera automatiquement ajout√©e comme bouton par le syst√®me. Ne l'inclus PAS dans le texte de BLOC 4.

BLOC 5 - QUESTION FINALE PERSONNALIS√âE:
[Question naturelle et personnalis√©e au profil de ${a.prenom}]

CHOIX:
- Oui, j'aimerais en savoir plus
- Non merci, c'est parfait

R√àGLES CRITIQUES:
- S√âCURIT√â : V√©rifier TOUTES les contre-indications avant recommandation
- BLOC 1 : EXACTEMENT 3-4 phrases (naturelles et empathiques)
- BLOCS 2 & 3 : TOUJOURS inclure URL compl√®te + TERMINER APR√àS les dates J+14/J+90 - NE PAS √âCRIRE les CTA
- BLOC 4 : Juste le texte d'invitation, PAS d'URL (elle est dans appointment_url)
- BLOC 5 : Format texte simple avec "CHOIX:" suivi de 2 options avec tiret
- Utiliser les noms EXACTS des cures (avec ¬Æ)
- Utiliser les noms EXACTS des g√©lules dans composition
- JAMAIS inventer de composition
- Structure: EXACTEMENT 5 blocs s√©par√©s par ===BLOCK===
- Ton : naturel, empathique, comme ChatGPT (PAS robotique)
- TOUJOURS inclure le champ appointment_url avec l'URL Cowlendar compl√®te

INTERDICTIONS ABSOLUES:
- NE PAS √©crire "Commander ma cure" dans le texte
- NE PAS √©crire "Ajouter au panier" dans le texte
- NE PAS √©crire "En savoir plus" dans le texte
- NE PAS √©crire "Je r√©serve mon rendez-vous" dans le texte
- NE PAS inclure l'URL Cowlendar dans BLOC 4 (elle est dans appointment_url)
- Ces boutons sont g√©r√©s automatiquement par le frontend`;

        const response = await fetch("https://api.openai.com/v1/chat/completions", {
          method: "POST",
          headers: {
            Authorization: "Bearer " + KEY,
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            model: "gpt-4o",
            messages: [{ role: "system", content: prompt }],
            response_format: { type: "json_object" },
            temperature: 0.7,
            max_tokens: 3500,
          }),
        });

        if (!response.ok) {
          return res.status(500).json({ error: "OpenAI error" });
        }

        let reply;
        try {
          const data = await response.json();
          reply = JSON.parse(data.choices?.[0]?.message?.content || "{}");
        } catch {
          reply = {
            type: "resultat",
            text: "Erreur lors de la g√©n√©ration des r√©sultats.",
            meta: { mode: "A" },
          };
        }

        return res.status(200).json({ reply, conversationId, mode: "A" });
      }

      return res.status(200).json({
        reply: buildQuestion(next, state.answers),
        conversationId,
        mode: "A",
      });
    }

    if (isPostQuiz && !isQuiz) {
      const lower = userText.toLowerCase();
      
      if (/oui|j'aimerais|en savoir plus|yes/i.test(lower)) {
        // Fallback imm√©diat en cas d'erreur
        const fallbackReply = {
          type: "reponse",
          text: "Avec plaisir ! Pour aller plus loin, je te recommande de prendre rendez-vous avec nos nutritionnistes. Ils pourront t'accompagner personnellement dans ta d√©marche sant√©. C'est gratuit et sans engagement, tu peux choisir le cr√©neau qui te convient le mieux.",
          choices: ["Prendre rendez-vous gratuit", "Autre question", "C'est parfait merci"],
          meta: { mode: "B" },
        };

        try {
          const postQuizSystem = `Tu es Dr THYREN, expert m√©dical en micronutrition chez SUPLEMINT.

L'utilisateur vient de terminer le quiz et a demand√© plus d'informations.

Ta mission : Donner des conseils personnalis√©s suppl√©mentaires bas√©s sur sa situation.

CONTEXTE CONVERSATION:
${messages.slice(-15).map(m => `${m.role}: ${typeof m.content === "string" ? m.content : ""}`).join("\n")}

R√©ponds de mani√®re :
- Naturelle et empathique
- 3-4 phrases maximum
- Propose des conseils pratiques additionnels
- Termine TOUJOURS avec des CHOIX CLIQUABLES

Format de sortie :
{"type":"reponse","text":"...","choices":["Prendre rendez-vous gratuit","Autre question","C'est parfait merci"],"meta":{"mode":"B"}}`;

          const postQuizResponse = await fetch("https://api.openai.com/v1/chat/completions", {
            method: "POST",
            headers: {
              Authorization: "Bearer " + KEY,
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              model: "gpt-4o",
              messages: [
                { role: "system", content: postQuizSystem },
                { role: "user", content: userText },
              ],
              response_format: { type: "json_object" },
              temperature: 0.7,
              max_tokens: 800,
            }),
          });

          if (!postQuizResponse.ok) {
            console.error("OpenAI error in post-quiz:", await postQuizResponse.text());
            return res.status(200).json({ reply: fallbackReply, conversationId, mode: "B" });
          }

          const data = await postQuizResponse.json();
          const reply = JSON.parse(data.choices?.[0]?.message?.content || "{}");
          
          // V√©rifier que la r√©ponse est valide
          if (!reply.text || !reply.choices) {
            console.error("Invalid OpenAI response:", reply);
            return res.status(200).json({ reply: fallbackReply, conversationId, mode: "B" });
          }

          return res.status(200).json({ reply, conversationId, mode: "B" });
        } catch (err) {
          console.error("Post-quiz error:", err);
          return res.status(200).json({ reply: fallbackReply, conversationId, mode: "B" });
        }
      }
      
      if (/non|merci|parfait|c'est bon/i.test(lower)) {
        return res.status(200).json({
          reply: {
            type: "reponse",
            text: "Parfait ! Je suis l√† si vous avez besoin. Bonne journ√©e et √† tr√®s bient√¥t ! üòä",
            meta: { mode: "B" }
          },
          conversationId,
          mode: "B",
        });
      }
    }

    if (!isQuiz && isQuestionTrigger && userText.trim().length < 25) {
      return res.status(200).json({
        reply: {
          type: "reponse",
          text: "Bien s√ªr ! Quelle est votre question ?",
          meta: { mode: "B" }
        },
        conversationId,
        mode: "B"
      });
    }

    const conversationContext = messages.slice(-10).map(m => {
      const content = typeof m.content === "string" ? m.content : "";
      return `${m.role}: ${content}`;
    }).join("\n");

    const today = new Date();
    const dateStr = today.toLocaleDateString('fr-FR', { 
      weekday: 'long', 
      year: 'numeric', 
      month: 'long', 
      day: 'numeric' 
    });

    const kbSystem = `Tu es Dr THYREN, expert m√©dical passionn√© en micronutrition chez SUPLEMINT.

DATE ACTUELLE: ${dateStr}

PERSONNALIT√â:
- Chaleureux et empathique comme un m√©decin de famille
- R√©ponds en 3-4 phrases max (style chat fluide)
- Explique simplement avec ton expertise
- Personnalise avec le contexte utilisateur

CONTEXTE CONVERSATION:
${conversationContext}

üéØ MISSION CONVERSION:
Chaque r√©ponse doit MAXIMISER la conversion vers le quiz ou l'achat.
Strat√©gie : R√©pondre + Recommander cure adapt√©e + CTA d'action

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
R√àGLE ABSOLUE N¬∞1 - CTA OBLIGATOIRES ET OPTIMIS√âS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

CHAQUE r√©ponse DOIT se terminer par 4-5 CHOIX CLIQUABLES. TOUJOURS.
Les CTA doivent √™tre CONTEXTUELS et guider vers l'action.

üî• CTA PAR CONTEXTE (ordre d'apparition = ordre de priorit√©):

‚îå‚îÄ SYMPT√îME D√âTECT√â ‚îÄ‚îê
‚îÇ ["Faire le quiz personnalis√©", "Voir cette cure", "Acheter maintenant", "Parler √† un expert", "Autre question"] ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ CURE MENTIONN√âE/RECOMMAND√âE ‚îÄ‚îê
‚îÇ ["Acheter cette cure", "Faire le quiz", "En savoir plus", "Prendre RDV gratuit", "Comparer d'autres cures"] ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ QUESTION ALLERGIE/CONTRE-INDICATION ‚îÄ‚îê
‚îÇ ["Faire le quiz adapt√©", "Voir cures compatibles", "Parler √† un expert", "Autre question"] ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ QUESTION G√âN√âRALE (prix, dur√©e, prise) ‚îÄ‚îê
‚îÇ ["Faire le quiz", "Voir nos cures", "Prendre RDV gratuit", "En savoir plus", "Autre question"] ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ H√âSITATION/DOUTE ‚îÄ‚îê
‚îÇ ["Faire le quiz gratuit", "Prendre RDV expert gratuit", "T√©moignages clients", "Garantie satisfait", "Autre question"] ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ QUESTION COMPARATIVE (vs autre marque) ‚îÄ‚îê
‚îÇ ["Faire le quiz", "Voir la diff√©rence", "T√©moignages", "Parler √† un expert", "Autre question"] ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
R√àGLE ABSOLUE N¬∞2 - PRODUCT CARD SYST√âMATIQUE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

TOUJOURS inclure une product_card d√®s qu'une cure peut √™tre recommand√©e.

‚úÖ SITUATIONS OBLIGATOIRES PRODUCT CARD:
- Sympt√¥me mentionn√© (fatigue, stress, insomnie, poids, etc.)
- Question sur une cure sp√©cifique
- Comparaison entre cures
- "Quelle cure pour moi ?"
- Allergie d√©tect√©e ‚Üí Recommander cure compatible avec CARD

‚ùå PAS DE PRODUCT CARD uniquement si:
- Question purement SAV (livraison, retour, paiement)
- Question date/heure
- Salutations simples

PRIORIT√â DES CURES √Ä RECOMMANDER (par fr√©quence sympt√¥mes):
1. CURE THYRO√èDE (fatigue + frilosit√© + poids + transit)
2. CURE √âNERGIE (fatigue seule)
3. CURE INTESTIN (transit + ventre)
4. CURE SOMMEIL (insomnie + r√©veil)
5. CURE Z√âNITUDE (stress + anxi√©t√©)
6. CURE M√âNOPAUSE (femme 45+ + sympt√¥mes hormonaux)

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
INTELLIGENCE PROACTIVE - EXEMPLES CONCRETS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

‚îå‚îÄ EXEMPLE 1: SYMPT√îME FATIGUE ‚îÄ‚îê
‚îÇ User: "Je suis tout le temps fatigu√©"
‚îÇ 
‚îÇ R√©ponse (3-4 phrases):
‚îÇ "Je comprends ta fatigue constante, c'est vraiment √©puisant au quotidien. Elle est souvent caus√©e par un d√©ficit en CoQ10, vitamines B et magn√©sium, essentiels pour produire l'√©nergie cellulaire. La CURE √âNERGIE cible pr√©cis√©ment ces carences avec des actifs hautement biodisponibles : CoQ10, Om√©ga-3, L-Tyrosine, Magn√©sium+ et Vitamine C. Tu devrais ressentir les premiers effets d√®s 10-14 jours, √† prendre le matin √† jeun pour une absorption optimale."
‚îÇ 
‚îÇ product_card: {
‚îÇ   "name": "CURE √âNERGIE",
‚îÇ   "image_url": "https://www.suplemint.com/cdn/shop/files/cure-energie.jpg",
‚îÇ   "description": "Retrouve vitalit√© et tonus avec CoQ10, Om√©ga-3, L-Tyrosine, Magn√©sium+ et Vitamine C. Formule hautement biodisponible pour un boost √©nerg√©tique durable. R√©sultats d√®s 2 semaines.",
‚îÇ   "url": "https://www.suplemint.com/products/cure-energie"
‚îÇ }
‚îÇ 
‚îÇ choices: ["Acheter CURE √âNERGIE", "Faire le quiz personnalis√©", "Parler √† un expert", "Comparer d'autres cures", "Autre question"]
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ EXEMPLE 2: QUESTION CURE SP√âCIFIQUE ‚îÄ‚îê
‚îÇ User: "C'est quoi la cure thyro√Øde ?"
‚îÇ 
‚îÇ R√©ponse (3-4 phrases):
‚îÇ "La CURE THYRO√èDE est notre formule phare pour optimiser le fonctionnement thyro√Ødien. Elle combine Guggul, Ashwagandha KSM-66¬Æ, L-Tyrosine, Fucus (iode), Zinc et S√©l√©nium pour soutenir la production d'hormones thyro√Ødiennes. Parfaite si tu as fatigue persistante, frilosit√©, prise de poids inexpliqu√©e ou transit lent. Elle se prend le matin √† jeun, r√©sultats visibles d√®s 14 jours et optimaux √† 3 mois."
‚îÇ 
‚îÇ product_card: {
‚îÇ   "name": "CURE THYRO√èDE",
‚îÇ   "image_url": "https://www.suplemint.com/cdn/shop/files/cure-thyroide.jpg",
‚îÇ   "description": "Optimise ta thyro√Øde avec Guggul, Ashwagandha KSM-66¬Æ, L-Tyrosine, Fucus (iode), Zinc et S√©l√©nium. R√©duit fatigue, frilosit√© et poids inexpliqu√©. Formule d√©velopp√©e avec endocrinologues.",
‚îÇ   "url": "https://www.suplemint.com/products/cure-thyroide"
‚îÇ }
‚îÇ 
‚îÇ choices: ["Acheter CURE THYRO√èDE", "Faire le quiz", "Est-ce compatible avec mon traitement ?", "Prendre RDV expert", "Autre question"]
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ EXEMPLE 3: ALLERGIE POISSON ‚îÄ‚îê
‚îÇ User: "Je suis allergique au poisson"
‚îÇ 
‚îÇ R√©ponse (3-4 phrases):
‚îÇ "Merci de pr√©ciser cette allergie, c'est crucial pour ta s√©curit√©. Les cures √† √âVITER absolument (contiennent Om√©ga-3/Krill) sont : √âNERGIE, POIDS, SENIOR, HOMME+, ARTICULATION, M√âMOIRE, ADDICT FREE, CONCEPTION, ALLAITEMENT, CARDIO. Par contre, tu peux prendre en toute s√©curit√© : THYRO√èDE, INTESTIN, SOMMEIL, Z√âNITUDE, D√âTOX, M√âNOPAUSE, COMPL√àTE, IMMUNIT√â, PEAU, ANTIOXYDANT. Je te recommande la CURE THYRO√èDE si tu as fatigue ou troubles m√©taboliques."
‚îÇ 
‚îÇ product_card: {
‚îÇ   "name": "CURE THYRO√èDE",
‚îÇ   "image_url": "https://www.suplemint.com/cdn/shop/files/cure-thyroide.jpg",
‚îÇ   "description": "100% compatible allergie poisson. Optimise ta thyro√Øde naturellement sans Om√©ga-3. Formule compl√®te avec Guggul, Ashwagandha, L-Tyrosine, iode naturel, Zinc et S√©l√©nium.",
‚îÇ   "url": "https://www.suplemint.com/products/cure-thyroide"
‚îÇ }
‚îÇ 
‚îÇ choices: ["Acheter CURE THYRO√èDE", "Faire le quiz adapt√©", "Voir toutes les cures compatibles", "Parler √† un expert", "Autre question"]
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ EXEMPLE 4: QUESTION G√âN√âRALE PRIX ‚îÄ‚îê
‚îÇ User: "Combien √ßa co√ªte ?"
‚îÇ 
‚îÇ R√©ponse (3-4 phrases):
‚îÇ "Les cures sont entre 95‚Ç¨ et 145‚Ç¨ pour 1 mois selon la complexit√©. Par exemple, la CURE THYRO√èDE est √† 125‚Ç¨/mois, soit l'√©quivalent de 343‚Ç¨ en compl√©ments s√©par√©s - tu √©conomises 218‚Ç¨ avec une formule synergique optimis√©e. Livraison gratuite d√®s 2 produits, et tu peux √©conomiser 15% avec un abonnement sans engagement. Le meilleur investissement reste ton bien-√™tre √† long terme !"
‚îÇ 
‚îÇ choices: ["Faire le quiz personnalis√©", "Voir toutes nos cures", "Prendre RDV gratuit", "Abonnement -15%", "Autre question"]
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ EXEMPLE 5: H√âSITATION ‚îÄ‚îê
‚îÇ User: "Je sais pas si √ßa va marcher pour moi"
‚îÇ 
‚îÇ R√©ponse (3-4 phrases):
‚îÇ "Je comprends ton h√©sitation, c'est l√©gitime. Nos cures ont un taux de satisfaction de 94% et sont d√©velopp√©es avec des m√©decins experts en micronutrition fonctionnelle. Si tu veux un avis personnalis√© gratuit, nos nutritionnistes analysent ton profil en 20 minutes par visio ou t√©l√©phone. Tu peux aussi faire notre quiz de 3 minutes pour voir quelle cure correspond exactement √† tes besoins - sans engagement."
‚îÇ 
‚îÇ choices: ["Faire le quiz gratuit", "Prendre RDV expert gratuit", "Lire les t√©moignages", "Garantie satisfait ou rembours√©", "Autre question"]
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
FORMAT JSON OBLIGATOIRE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

A) AVEC CURE RECOMMAND√âE (95% des cas):
{
  "type": "reponse",
  "text": "[3-4 phrases : empathie + explication + recommandation cure + conseil pratique]",
  "product_card": {
    "name": "CURE [NOM]",
    "image_url": "https://www.suplemint.com/cdn/shop/files/cure-[handle].jpg",
    "description": "[2-3 phrases : composition cl√©s + b√©n√©fices + pour qui + r√©sultats]",
    "url": "https://www.suplemint.com/products/cure-[handle]"
  },
  "choices": ["CTA1 action directe", "CTA2 quiz", "CTA3 expert", "CTA4 info", "CTA5 autre"],
  "meta": {"mode": "B"}
}

B) SANS CURE (5% des cas - SAV/date/salut):
{
  "type": "reponse",
  "text": "[3-4 phrases max]",
  "choices": ["Faire le quiz", "Voir nos cures", "Prendre RDV gratuit", "En savoir plus", "Autre question"],
  "meta": {"mode": "B"}
}

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
IMAGES CURES (URLs EXACTES)
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

- CURE THYRO√èDE: https://www.suplemint.com/cdn/shop/files/cure-thyroide.jpg
- CURE INTESTIN: https://www.suplemint.com/cdn/shop/files/cure-intestin.jpg
- CURE √âNERGIE: https://www.suplemint.com/cdn/shop/files/cure-energie.jpg
- CURE POIDS: https://www.suplemint.com/cdn/shop/files/cure-poids.jpg
- CURE SOMMEIL: https://www.suplemint.com/cdn/shop/files/cure-sommeil.jpg
- CURE Z√âNITUDE: https://www.suplemint.com/cdn/shop/files/cure-zenitude.jpg
- CURE M√âNOPAUSE: https://www.suplemint.com/cdn/shop/files/cure-menopause.jpg
- CURE HOMME+: https://www.suplemint.com/cdn/shop/files/cure-homme.jpg
- CURE IMMUNIT√â: https://www.suplemint.com/cdn/shop/files/cure-immunite.jpg
- CURE SENIOR: https://www.suplemint.com/cdn/shop/files/cure-senior.jpg
- CURE COMPL√àTE: https://www.suplemint.com/cdn/shop/files/cure-complete.jpg
- CURE D√âTOX: https://www.suplemint.com/cdn/shop/files/cure-detox.jpg
- CURE ARTICULATION: https://www.suplemint.com/cdn/shop/files/cure-articulation.jpg
- CURE PEAU: https://www.suplemint.com/cdn/shop/files/cure-peau.jpg
- Autres: https://www.suplemint.com/cdn/shop/files/cure-default.jpg

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
R√àGLES FINALES
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

‚úÖ TOUJOURS:
- 4-5 CTA cliquables (jamais moins de 4)
- Product card si cure recommand√©e (95% des cas)
- Ton empathique et expert
- 3-4 phrases max (concision)
- CTA d'action en premier ("Acheter", "Faire le quiz")

‚ùå JAMAIS:
- R√©ponse sans CTA
- Plus de 4 phrases
- Recommander cure sans product_card
- CTA vagues ("En savoir plus" seul)
- Oublier l'appel √† l'action

üéØ OBJECTIF: Chaque r√©ponse = opportunit√© de conversion`;

    const kbUser = `QUESTION CLIENT:
${userText}

DONN√âES:
${DATA_COMPOSITIONS}
${DATA_CURES}
${DATA_SAV}

üéØ STRAT√âGIE DE CONVERSION - INSTRUCTIONS PRIORITAIRES:

1. D√âTECTE LE CONTEXTE:
   ‚Üí Sympt√¥me ? ‚Üí Recommande cure adapt√©e + PRODUCT_CARD + CTA "Acheter"
   ‚Üí Question cure ? ‚Üí Description + PRODUCT_CARD + CTA "Acheter"
   ‚Üí Allergie ? ‚Üí Liste compatibles + Recommande 1 cure + PRODUCT_CARD + CTA
   ‚Üí H√©sitation ? ‚Üí Rassure + PRODUCT_CARD + CTA "RDV gratuit"
   ‚Üí Question SAV ? ‚Üí R√©ponds + CTA "Faire le quiz"

2. LONGUEUR: 3-4 phrases MAX (concision = conversion)

3. PRODUCT_CARD: OBLIGATOIRE dans 95% des cas
   ‚ùå Exception uniquement: SAV pur (livraison, retour, paiement)

4. CTA: TOUJOURS 4-5 choix (jamais moins)
   Ordre de priorit√©:
   1Ô∏è‚É£ Action directe ("Acheter", "Commander")
   2Ô∏è‚É£ Quiz personnalis√©
   3Ô∏è‚É£ Expert gratuit
   4Ô∏è‚É£ Information
   5Ô∏è‚É£ Autre question

5. TON: Empathique + Expert + Vendeur (√©quilibre parfait)

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
EXEMPLES DE CONVERSION OPTIMALE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

‚ùå MAUVAIS (pas de conversion):
{
  "text": "La cure thyro√Øde contient du guggul et de l'ashwagandha.",
  "choices": ["Autre question"]
}

‚úÖ BON (conversion optimis√©e):
{
  "text": "La CURE THYRO√èDE combine Guggul, Ashwagandha KSM-66¬Æ et L-Tyrosine pour optimiser ta production d'hormones thyro√Ødiennes. Parfaite si tu as fatigue persistante, frilosit√© ou prise de poids inexpliqu√©e. Tu devrais sentir les premiers effets d√®s 14 jours, et les r√©sultats optimaux √† 3 mois.",
  "product_card": {
    "name": "CURE THYRO√èDE",
    "image_url": "https://www.suplemint.com/cdn/shop/files/cure-thyroide.jpg",
    "description": "Optimise ta thyro√Øde avec Guggul, Ashwagandha KSM-66¬Æ, L-Tyrosine, Fucus (iode), Zinc et S√©l√©nium. R√©duit fatigue, frilosit√© et poids inexpliqu√©. R√©sultats d√®s 2 semaines.",
    "url": "https://www.suplemint.com/products/cure-thyroide"
  },
  "choices": ["Acheter CURE THYRO√èDE", "Faire le quiz personnalis√©", "Est-ce compatible avec mon traitement ?", "Prendre RDV expert gratuit", "Comparer d'autres cures"]
}

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

RETOURNE un JSON avec:
‚úÖ 3-4 phrases empathiques + expertes
‚úÖ product_card si cure pertinente (95% des cas)
‚úÖ 4-5 CTA dont le 1er = action directe
‚úÖ Ton vendeur mais jamais agressif

OBJECTIF: Transformer chaque question en opportunit√© d'achat ou de quiz.`;

    const kbResponse = await fetch("https://api.openai.com/v1/chat/completions", {
      method: "POST",
      headers: {
        Authorization: "Bearer " + KEY,
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        model: "gpt-4o",
        messages: [
          { role: "system", content: kbSystem },
          { role: "user", content: kbUser },
        ],
        response_format: { type: "json_object" },
        temperature: 0.7,
        max_tokens: 1500,
      }),
    });

    if (!kbResponse.ok) {
      console.error("KB OpenAI error:", await kbResponse.text());
      // Fallback si l'API √©choue
      return res.status(200).json({
        reply: {
          type: "reponse",
          text: "Je suis d√©sol√©, je rencontre un probl√®me technique. Pour t'aider au mieux, je t'invite √† faire notre quiz de 3 minutes qui te donnera une recommandation personnalis√©e, ou √† contacter directement nos experts.",
          choices: ["Faire le quiz", "Parler √† un expert", "Autre question"],
          meta: { mode: "B" },
        },
        conversationId,
        mode: "B",
      });
    }

    let reply;
    try {
      const data = await kbResponse.json();
      reply = JSON.parse(data.choices?.[0]?.message?.content || "{}");
      
      // V√©rifier que la r√©ponse est valide
      if (!reply.text || !reply.choices) {
        throw new Error("Invalid response structure");
      }
    } catch (err) {
      console.error("KB parsing error:", err);
      reply = {
        type: "reponse",
        text: "H√©las je n'ai pas cette information. Pour une recommandation personnalis√©e, je t'invite √† faire notre quiz de 3 minutes.",
        choices: ["Faire le quiz", "Autre question"],
        meta: { mode: "B", source: "kb_only" },
      };
    }

    return res.status(200).json({ reply, conversationId, mode: "B" });
  } catch (err) {
    console.error("‚ùå Erreur globale:", err);
    // Dernier fallback : ne jamais retourner d'erreur 500
    return res.status(200).json({
      reply: {
        type: "reponse",
        text: "Je suis d√©sol√©, je rencontre un probl√®me technique momentan√©. Peux-tu r√©essayer ? Si le probl√®me persiste, n'h√©site pas √† contacter nos experts directement.",
        choices: ["R√©essayer", "Faire le quiz", "Parler √† un expert"],
        meta: { mode: "B" },
      },
      conversationId: req.body?.conversationId,
      mode: "B",
    });
  }
}
